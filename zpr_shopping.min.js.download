var products_list,frame_hash,placementShopping,was_shopping_displayed,was_shopping_fetched,SHOULD_SEND_EVENT_VIEW,OLD_VERSION
function pollster_result_event(e){pollsterTrack.event({gid:"zpr_shopping_rec_test",type:"view",content:{frame_hash:frame_hash,placementShopping:placementShopping,show_reco_block_result:""+e,rec_id:""+rec_id_hash}})}function pollster_decide_to_render(){pollster_get_recommend_products().then(function(e){rec_id_hash=e.rec_id,"true"===e.response&&1<e.products.length?(get_3_our_id(e),console.log("Pollster - odpowiedź "+e.response),SHOULD_SEND_EVENT_VIEW=!0):(hide_shopping_div(),console.log("Pollster odpowiedź odp - false")),pollster_result_event(e.response),sendVisibilityEventsShopping()}).catch(function(e){console.log("Error Skrypt Pollstar: "+e),console.log("Renderujemy starą metodą."),rec_id_hash="error_hash",OLD_VERSION=!0,render_div_old_version(),pollster_result_event(e),sendVisibilityEventsShopping()})}function sendVisibilityEventsShopping(){var e
"undefined"!=typeof setVisibilityEvent?(e=document.getElementById("article_zpr_shopping"),setVisibilityEvent(e,"zpr_shopping")):console.log("nie znaleziono funkcji")}function getProductsIdsFromResponse(e){return e.products.map(e=>e.id)}function hide_shopping_div(){var e=document.getElementById("article_zpr_shopping")
e.setAttribute("style",""),e.setAttribute("hidden",!0)}function render_div_old_version(){var e=document.querySelector("article")
recommendations_get_products("/api/recommendations/"+e.getAttribute("article_uid")+"/products/"+("?page_uid="+e.getAttribute("page_uid"))).then(function(e){"\n"!=e?insert_html(e):(console.log("pusta odp od nas."),hide_shopping_div())}).catch(function(e){hide_shopping_div(),console.log("Error: "+e)})}function get_3_our_id(t){var e=document.querySelector("article")
recommendations_get_products_json("/api/recommendations/"+e.getAttribute("article_uid")+"/products/json/"+("?page_uid="+e.getAttribute("page_uid"))).then(function(e){render_div(t,e)}).catch(function(e){console.log("Error nasz id: "+e),hide_shopping_div()})}function render_div(e,t){var o=document.querySelector("article").getAttribute("page_uid"),e=getProductsIdsFromResponse(e),t=t.product_ids_with_score.map(e=>e)
recommendations_get_products("/api/recommendations/selected_products/"+("?page_uid="+o+"&products_ids="+e.join(",")+"&our_ids_with_score="+t.join(","))).then(function(e){("\n"!=e?(insert_html(e),send_showed_products):(console.log("pusta odp od nas."),hide_shopping_div))()}).catch(function(e){hide_shopping_div(),console.log("Error: "+e)})}function insert_html(e){var t=document.getElementById("article_zpr_shopping")
t.innerHTML=e,Array.from(t.querySelectorAll("script")).forEach(function(e){let t=document.createElement("script")
Array.from(e.attributes).forEach(function(e){t.setAttribute(e.name,e.value)}),t.appendChild(document.createTextNode(e.innerHTML)),e.parentNode.replaceChild(t,e)})}function shopping_add_product(e){window.ShoppingJsonpCallback=function(e){}
var t=document.createElement("script")
t.setAttribute("src","https://www.urzadzamy.pl/shopping_set_product_id?callback=ShoppingJsonpCallback&http_response=1&product_id="+e),document.body.appendChild(t)}function ClickPollster(e,t,o,n,i,r,s,p,d,c,_,l){shopping_add_product(c)
_=get_button_colour(_)
pollsterTrack.event({rec_id:""+rec_id_hash,gid:"zpr_shopping",type:"click",content:{frame_hash:o,product_id:t,client_uid:n,placementShopping:placementShopping,campaign_uid:i,category:r,score:s,url:e,title:p,button_name:d,button_colour:_,product_position:l}}),OLD_VERSION||send_clicked_products(c),window.open(e,"_blank")}function get_button_colour(e){e=(null!==e.previousSibling?getComputedStyle(e.children[2]):getComputedStyle(e.nextSibling.children[2])).backgroundColor
return RGB_to_hex(e)}function RGB_to_hex(e){var t=-1<e.indexOf(",")?",":" "
let o=(+(e=e.substr(4).split(")")[0].split(t))[0]).toString(16),n=(+e[1]).toString(16),i=(+e[2]).toString(16)
return 1==o.length&&(o="0"+o),1==n.length&&(n="0"+n),1==i.length&&(i="0"+i),"#"+o+n+i}function is_visible_el(e){var t,o
if(null!=e)return e=e.getBoundingClientRect(),t=window.innerHeight||document.documentElement.clientHeight,o=window.innerWidth||document.documentElement.clientWidth,t=e.top<=t&&0<=e.top+e.height,o=e.left<=o&&0<=e.left+e.width,t&&o}function handle_dynamic_showing_products(e){e.getBoundingClientRect().top-200<=window.scrollY+window.innerHeight&&!was_shopping_fetched&&(pollster_decide_to_render(),was_shopping_fetched=!0),send_viewed_event_to_pollster(e)}function send_viewed_event_to_pollster(e){e=e.nextElementSibling
!was_shopping_displayed&&SHOULD_SEND_EVENT_VIEW&&is_visible_el(e)&&(was_shopping_displayed=!0,pollsterTrack.event({rec_id:""+rec_id_hash,gid:"zpr_shopping",type:"view",content:{frame_hash:frame_hash,products:products_list,placementShopping:placementShopping}}),console.log("Event view"))}function send_showed_products(){pollster_showed_products(products_list.map(e=>e.object_id),rec_id_hash).then(e=>{console.log("Udało się wysłać pokazane produkty")}).catch(e=>{console.log("Nie udało się wysłać pokazanych produktów pollsterowi")})}function send_clicked_products(e){pollster_clicked_product(e,rec_id_hash).then(e=>{console.log("udało się wysłać kliknięty produkty")}).catch(e=>{console.log("Nie udało się wysłać klikniętego produktu")})}async function pollster_get_recommend_products(){var e={url:window.location.href.split("?")[0],n:3}
const t=new AbortController
var o=setTimeout(()=>t.abort(),3e3),e=await fetch("https://zpr-webapp.v2.pollster.pl/new/recommend",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),signal:t.signal})
if(clearTimeout(o),e.ok)return response_json=await e.json()
throw new Error("HTTP "+e.status+", Message: "+await e.json())}async function pollster_showed_products(e,t){e=await fetch("https://zpr-webapp.v2.pollster.pl/new/shown_products",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_ids:e,rec_id:t})})
if(e.ok)return response_text=await e.text()
throw new Error("HTTP "+e.status+", Message: "+await e.text())}async function pollster_clicked_product(e,t){e=await fetch("https://zpr-webapp.v2.pollster.pl/new/clicked_product",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:e,rec_id:t})})
if(e.ok)return response_text=await e.text()
throw new Error("HTTP "+e.status+", Message: "+await e.text())}async function recommendations_get_products(e){e=await fetch(e,{method:"GET"})
if(e.ok)return response_text=await e.text()
throw new Error("HTTP "+e.status+", Message: "+await e.text())}async function recommendations_get_products_json(e){e=await fetch(e,{method:"GET"})
if(e.ok)return response_json=await e.json()
throw new Error("HTTP "+e.status+", Message: "+await e.json())}OLD_VERSION=SHOULD_SEND_EVENT_VIEW=was_shopping_fetched=was_shopping_displayed=!(placementShopping="zpr_shopping"),window.addEventListener("scroll",function(){var e=document.getElementById("article_zpr_shopping")
null!==e&&handle_dynamic_showing_products(e)})
