webpackJsonpppg__name_([3],{177:function(t,e,n){"use strict";n.d(e,"a",function(){return u});var r=n(0),a=n(10),o=n(20),i=n(184),s=n(11),u=function(){function t(t,e,r,a){var s=this;this.apiURL=t,this.getData=e,this.endSession=this.startSession();var u=Math.floor((r()-Date.now())/1e3);switch((0===u||u>14400)&&window.addEventListener("load",function(){return setTimeout(function(){return s.send()},50)},!1),this.inactivityInterval=setTimeout(function(){return s.send()},3e5),a){case"history":n.i(i.a)(window.history),o.a.on("pushstate",function(){return s.send()},!1);break;case"hash":window.addEventListener("hashchange",function(){return s.send()},!1);break;case"visibilitychange":window.addEventListener("visibilitychange",function(){if("visible"!==document.visibilityState)return this.send()})}window.addEventListener("unload",function(){return s.send()},!1)}return t.prototype.startSession=function(){var t=this,e=Date.now();return function(){return t.prepareToSendData({pageVisitTime:(Date.now()-e)/1e3,lastVisitDate:(new Date).toISOString(),referrer:document.referrer,origin:location.href,url:location.href.replace(/^.*\/\/[^\/]+/,"")})}},t.prototype.prepareToSendData=function(t){return JSON.stringify(n.i(s.a)(t,this.getData()))},t.prototype.send=function(){var t=navigator.sendBeacon(this.apiURL+"/beacon",this.endSession());return o.a.trigger("beacon",{result:t}),this.endSession=this.startSession(),this.inactivityInterval&&clearTimeout(this.inactivityInterval),t},r.h([a.b],t.prototype,"startSession",null),r.h([a.b],t.prototype,"prepareToSendData",null),r.h([a.b],t.prototype,"send",null),t}()},178:function(t,e,n){"use strict";n.d(e,"a",function(){return f});var r=n(0),a=n(177),o=n(179),i=n(20),s=n(49),u=n(10),l=n(35),c=n(6),p=n(1),h=n(11),f=function(t){function e(e,n){var r=t.call(this,e)||this;return r.capture=n,r}return r.g(e,t),e.prototype.getLastVisitTs=function(){var t=this.lastTs;return this.lastTs=Date.now(),t},e.prototype.getBeaconData=function(){var t=n.i(h.a)(this.selectorInstance.getData(),{projectId:this.options.projectId,subscriberId:this.subscriberIdExists(),testMode:n.i(c.a)()});t.tags=t.tags.concat(this.externalTags),t.tagsToDelete=this.externalTagsToDelete;var e=[];return n.i(p.a)(t.tags,function(t){return e.push(t.tag)}),t.tags=n.i(l.a)(t.tags,function(t){return!!t.tag&&!(e.indexOf(t)>-1)}),t.geoLocation=this.geoLocation,t},e.prototype.isBeaconInstanceRun=function(){return this.selectorInstance&&this.beaconInstance||!1},e.prototype.subscriberIdExists=function(){return this.subscriberId},e.prototype.internalBeaconRun=function(){var t=this;!1===this.isBeaconInstanceRun()&&this.subscriberIdExists()&&(this.selectorInstance=new o.a(this.options.beacon.selectors),this.beaconInstance=new a.a(this.options.apiURL,function(){return t.getBeaconData()},function(){return t.getLastVisitTs()},this.options.beacon.strategy))},e.prototype.run=function(){var t=this;i.a.on("tag",function(e){var r=e.state,a=e.tag,o=e.label,i=e.ttl,s=e.strategy;t.externalTags=n.i(l.a)(t.externalTags,function(t){return t.tag!==a}),t.externalTagsToDelete=n.i(l.a)(t.externalTagsToDelete,function(t){return t.tag!==a}),r?t.externalTags.push({tag:a,label:o||"default",ttl:i,strategy:s}):t.externalTagsToDelete.push({tag:a,label:o||"default"})}),i.a.on("geoLocation",function(e){t.geoLocation=e}),i.a.on("subscriberActive",function(e){return r.b(t,void 0,void 0,function(){return r.c(this,function(t){try{this.subscriberId=e.subscriberId,this.internalBeaconRun()}catch(t){this.capture(t)}return[2]})})}),this.internalBeaconRun()},r.h([s.a.lsProperty({defaults:null})],e.prototype,"subscriberId",void 0),r.h([s.a.lsProperty({defaults:0})],e.prototype,"lastTs",void 0),r.h([s.a.property({defaults:[]})],e.prototype,"externalTagsToDelete",void 0),r.h([s.a.property({defaults:[]})],e.prototype,"externalTags",void 0),r.h([s.a.property({})],e.prototype,"geoLocation",void 0),r.h([u.b],e.prototype,"getLastVisitTs",null),r.h([u.b],e.prototype,"getBeaconData",null),r.h([u.b],e.prototype,"isBeaconInstanceRun",null),r.h([u.b],e.prototype,"subscriberIdExists",null),r.h([u.b],e.prototype,"internalBeaconRun",null),r.h([u.b],e.prototype,"run",null),e}(s.a)},179:function(t,e,n){"use strict";function r(t){var e=null;try{e=document.querySelector(t)}catch(e){console.error(t,"is not a valid css selector")}return e}n.d(e,"a",function(){return h});var a,o=n(0),i=n(20),s=n(10),u=n(1),l=n(11),c=n(182),p=n(185);!function(t){t.integer="integer",t.float="float"}(a||(a={}));var h=function(){function t(t){var e=this;this.tags=new Map,this.data={},this.observers=[],this.globalBoundedSelectors=[],this.bindSelectorEvents(t),i.a.on("beacon",function(){e.resetState(),setTimeout(function(){return e.bindSelectorEvents(t)},100)},!1)}return t.prototype.resetState=function(){n.i(u.a)(this.observers,function(t){return clearInterval(t)}),this.observers=[],this.globalBoundedSelectors=[],this.tags=new Map,this.data={}},t.prototype.getData=function(){return n.i(l.a)(this.data,this.prepareTags())},t.prototype.prepareTags=function(){return{tags:o.f(this.tags.values())}},t.prototype.getValueOfEl=function(t){return(t.textContent||t.value||"").trim().replace(/\r?\n|\r/g,"")},t.prototype.parseElementByType=function(t,e){if(!e)return"boolean"!==t.type&&null;var n=t.attribute?e.getAttribute(t.attribute):this.getValueOfEl(e);switch(t.type){case"boolean":return"click"===t.event||!!e;case"number":return"click"===t.event?1:this.parseToNumber(n);default:return n}},t.prototype.parseToNumber=function(t){var e=/[,.'\/\- :]/;t=t.replace(/[^\d,.'\/\- :]/,"");for(var n="",r=null,i=null,s=!1,u=a.integer,l=null,c=0;c<t.length;c++){if(n+=t[c],e.test(t[c])){u=a.float,r=c;var p=i;i=t[c],p&&p!==i&&(s=!0,l||(l=i)),r&&c-r>3&&!s&&(u=a.integer)}e.test(t[c])||r&&c-r==3&&!s&&(u=a.integer),r&&c-r>3&&!s&&(u=a.float)}if(l){var h=o.e(n.split(l)),f=h[0],d=h.slice(1);return Number.parseFloat(f.replace(/[^\d]/g,"")+"."+d.join("").replace(/[^\d]/g,""))}return u===a.float?Number.parseFloat(n.replace(",",".")):Number.parseInt(n.replace(/[^\d]/g,""))},t.prototype.parseByType=function(t,e){switch(t.type){case"number":return Number(e);case"boolean":return Boolean(e);case"date":return new Date(e);default:return String(e)}},t.prototype.observeElement=function(t,e,n,r,a){var o=this;void 0===a&&(a=500);var i=setInterval(function(){if(t[e[n]]||0===t[e[n]]||""===t[e[n]]||null===t[e[n]])return window.clearInterval(i);t[e[n]]=o.parseElementByType(e,r)},a);this.observers.push(i)},t.prototype.observeTagElement=function(t,e,n){var r=this;void 0===n&&(n=500);var a=setInterval(function(){if(r.tags.has(t.selector))return window.clearInterval(a);var n=r.parseElementByType(t,e);r.tags.set(t.selector,{tag:n,label:t.labelKey,ttl:t.labelTTL,strategy:t.labelStrategy})},n);this.observers.push(a)},t.prototype.observeJSVariable=function(t,e){var r=this;void 0===e&&(e=500);var a=setInterval(function(){if(r.data[t.name]||0===r.data[t.name]||""===r.data[t.name]||null===r.data[t.name])return window.clearInterval(a);var e=n.i(c.a)(window,t.selector),o=[].concat(e);for(var i in o){var s=o[i],u=r.parseByType(t,s);"tag"===t.name?void 0!==u&&"undefined"!==u&&r.tags.set(t.selector+"_"+i,{tag:u,label:t.labelKey,ttl:t.labelTTL,strategy:t.labelStrategy}):void 0!==u&&"undefined"!==u&&(r.data[t.name]=u)}},e);this.observers.push(a)},t.prototype.addEventBySelector=function(t,e){var n=this;switch(t.name){case"tag":return this.observeTagElement(t,e);default:if("view"===t.event)return this.observeElement(this.data,t,"name",e);if("click"===t.event&&t.bindAll)return void this.globalBoundedSelectors.push(t);if(this.data[t.name]=this.parseElementByType(t,null),!e)return;e.addEventListener(t.event,function(){n.data[t.name]=n.parseElementByType(t,e)})}},t.prototype.bindGlobalSelectors=function(){if(0!==this.globalBoundedSelectors.length){var t=this;document.addEventListener("click",function(e){var r=n.i(p.a)(t.globalBoundedSelectors),a=t.findElementParents(e);try{for(var i=o.d(r),s=i.next();!s.done;s=i.next()){var u=s.value,l=document.querySelectorAll(u.selector);try{for(var c=o.d(l),h=c.next();!h.done;h=c.next()){var f=h.value;if(-1!==a.indexOf(f))return void(t.data[u.name]=t.parseElementByType(u,f))}}catch(t){b={error:t}}finally{try{h&&!h.done&&(y=c.return)&&y.call(c)}finally{if(b)throw b.error}}}}catch(t){d={error:t}}finally{try{s&&!s.done&&(v=i.return)&&v.call(i)}finally{if(d)throw d.error}}var d,v,b,y})}},t.prototype.findElementParents=function(t){for(var e=[t.target],n=t.target;n.parentElement;)e.push(n.parentElement),n=n.parentElement;return e},t.prototype.bindSelectorEvents=function(t){var e=this;n.i(u.a)(t,function(t){t.selector&&(["custom_id_from_variable","getJS","tagJS"].indexOf(t.settingsType)>-1||t.selector.startsWith("window.")?e.observeJSVariable(t):e.addEventBySelector(t,r(t.selector)))}),this.bindGlobalSelectors()},o.h([s.b],t.prototype,"resetState",null),o.h([s.b],t.prototype,"getData",null),o.h([s.b],t.prototype,"prepareTags",null),o.h([s.b],t.prototype,"getValueOfEl",null),o.h([s.b],t.prototype,"parseElementByType",null),o.h([s.b],t.prototype,"parseToNumber",null),o.h([s.b],t.prototype,"parseByType",null),o.h([s.b],t.prototype,"observeElement",null),o.h([s.b],t.prototype,"observeTagElement",null),o.h([s.b],t.prototype,"observeJSVariable",null),o.h([s.b],t.prototype,"addEventBySelector",null),o.h([s.b],t.prototype,"bindGlobalSelectors",null),o.h([s.b],t.prototype,"findElementParents",null),o.h([s.b],t.prototype,"bindSelectorEvents",null),t}()},182:function(t,e,n){"use strict";function r(t,e){if("*"===t)return Object.keys(e);if(n.i(s.a)(t))return[t];var r=""+t,a=1/Number(t);return"0"==r&&a==-h?["-0"]:[r]}function a(t,e,n){if(1===t.length)return e[t[0]];try{for(var r=i.d(t),a=r.next();!a.done;a=r.next()){var o=a.value;if(e[o]&&e[o][n])return e[o]}}catch(t){s={error:t}}finally{try{a&&!a.done&&(u=r.return)&&u.call(r)}finally{if(s)throw s.error}}var s,u}function o(t,e){for(var n=0,o=p(e);null!=t&&n<o.length;){t=a(r(o[n++],t),t,o[n])}return n&&n===o.length?t:void 0}e.a=o;var i=n(0),s=n(183),u=".".charCodeAt(0),l=/\\(\\)?/g,c=RegExp("[^.[\\]]+|\\[(?:([^\"'][^[]*)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))","g"),p=function(t){var e=[];return t.charCodeAt(0)===u&&e.push(""),t.replace(c,function(t,n,r,a){var o=t;r?o=a.replace(l,"$1"):n&&(o=n.trim()),e.push(o)}),e},h=1/0},183:function(t,e,n){"use strict";function r(t){return"string"==typeof t}e.a=r},184:function(t,e,n){"use strict";function r(t){var e=t.pushState;t.pushState=function(r){return n.i(a.a)(t.onpushstate)&&t.onpushstate({state:r}),o.a.trigger("pushstate"),e.apply(t,arguments)}}e.a=r;var a=n(4),o=n(20)},185:function(t,e,n){"use strict";function r(t){return t.filter(function(t,e,n){return n.indexOf(t)===e})}e.a=r},30:function(t,e,n){"use strict";function r(t,e){return a.b(this,void 0,void 0,function(){var n,r;return a.c(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),n=new o.a(t,e),[4,n.sync()];case 1:return a.sent(),n.run(),[3,3];case 2:return r=a.sent(),e(r),[3,3];case 3:return[2]}})})}Object.defineProperty(e,"__esModule",{value:!0}),e.run=r;var a=n(0),o=n(178)},35:function(t,e,n){"use strict";function r(t,e){e=n.i(o.a)(e);var r=[];return n.i(a.a)(t,function(t,n){e(t,n)&&r.push(t)}),r}e.a=r;var a=n(1),o=n(2)}});
//# sourceMappingURL=plugin-beacon.js.map