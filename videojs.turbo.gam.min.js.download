/*! @name videojs-contrib-ads @version 6.9.0 @license Apache-2.0 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("video.js"),require("global/window"),require("global/document")):"function"==typeof define&&define.amd?define(["video.js","global/window","global/document"],e):(t=t||self).videojsContribAds=e(t.videojs,t.window,t.document)}(this,function(c,l,h){"use strict"
var a,i,n,e,o,s,r,u,d,p,g,y,W,N,t,m,F,U,O,f,v,A,P,V,x,q,H,z,K,G,J,Y,Z,$,Q,C,X,S
function tt(t){"playing"===t.type?e(this,t):"ended"===t.type?o(this,t):"loadstart"===t.type||"loadeddata"===t.type||"loadedmetadata"===t.type?s(this,t):"play"===t.type?r(this,t):this.ads.isInAdMode()&&(this.ads.isContentResuming()?n(this,"content",t):n(this,"ad",t))}function et(){!1!==this.ads._shouldBlockPlay&&(this.paused()||(this.ads.debug("Playback was canceled by cancelContentPlay"),this.pause()),this.ads._cancelledPlay=!0)}function k(t){this.player=t}function b(){}function L(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}function E(t){return(t=H.call(this,t)||this).contentResuming=!1,t.waitingForAdBreak=!1,t}function T(){return z.apply(this,arguments)||this}function M(){return K.apply(this,arguments)||this}function w(){return G.apply(this,arguments)||this}function D(){return J.apply(this,arguments)||this}function R(){return Y.apply(this,arguments)||this}function I(){return Z.apply(this,arguments)||this}function j(){return $.apply(this,arguments)||this}function _(){return Q.apply(this,arguments)||this}function B(){return X.apply(this,arguments)||this}return c=c&&c.hasOwnProperty("default")?c.default:c,l=l&&l.hasOwnProperty("default")?l.default:l,h=h&&h.hasOwnProperty("default")?h.default:h,a="6.9.0",i=function(t,e){e.isImmediatePropagationStopped=function(){return!0},e.cancelBubble=!0,e.isPropagationStopped=function(){return!0}},n=function(t,e,n){i(0,n),t.trigger({type:e+n.type,originalEvent:n})},e=function(t,e){t.ads.isInAdMode()&&(t.ads.isContentResuming()?t.ads._contentEnding&&n(t,"content",e):n(t,"ad",e))},o=function(t,e){t.ads.isInAdMode()?t.ads.isContentResuming()?(i(0,e),t.trigger("resumeended")):n(t,"ad",e):t.ads._contentHasEnded||t.ads.stitchedAds()||(n(t,"content",e),t.trigger("readyforpostroll"))},s=function(t,e){"loadstart"===e.type&&!t.ads._hasThereBeenALoadStartDuringPlayerLife||"loadeddata"===e.type&&!t.ads._hasThereBeenALoadedData||"loadedmetadata"===e.type&&!t.ads._hasThereBeenALoadedMetaData||(t.ads.inAdBreak()?n(t,"ad",e):t.currentSrc()===t.ads.contentSrc&&n(t,"content",e))},r=function(t,e){t.ads.inAdBreak()?n(t,"ad",e):t.ads.isContentResuming()&&n(t,"content",e)},u={},d=function(){if(c.dom.isInFrame()&&"function"!=typeof l.__tcfapi){for(var s,t=l,r={};t;){try{if(t.frames.__tcfapiLocator){s=t
break}}catch(t){}if(t===l.top)break
t=t.parent}s&&(l.__tcfapi=function(t,e,n,i){var o=Math.random()+"",t={__tcfapiCall:{command:t,parameter:i,version:e,callId:o}}
r[o]=n,s.postMessage(t,"*")},l.addEventListener("message",function(t){var e={}
try{e="string"==typeof t.data?JSON.parse(t.data):t.data}catch(t){}(e=e.__tcfapiReturn)&&"function"==typeof r[e.callId]&&(r[e.callId](e.returnValue,e.success),r[e.callId]=null)},!1))}"function"==typeof l.__tcfapi&&l.__tcfapi("addEventListener",2,function(t,e){e&&(u=t)})},p=function(t,e){return e?encodeURIComponent(t):t},g=function(t,e,n){if(t&&t[n])for(var i=t[n],o=Object.keys(i),s=0;s<o.length;s++)e["{mediainfo."+n+"."+o[s]+"}"]=i[o[s]]},W=function(t,e){return void 0!==e&&t.ads.includedCues[e]},N=function(t,e){void 0!==e&&""!==e&&(t.ads.includedCues[e]=!0)},y={processMetadataTracks:function(e,n){for(var t=e.textTracks(),i=function(t){"metadata"===t.kind&&(e.ads.cueTextTracks.setMetadataTrackMode(t),n(e,t))},o=0;o<t.length;o++)i(t[o])
t.addEventListener("addtrack",function(t){i(t.track)})},setMetadataTrackMode:function(t){},getSupportedAdCue:function(t,e){return e},isSupportedAdCue:function(t,e){return!0},getCueId:function(t,e){return e.id},processAdTrack:function(t,e,n,i){var o,s,r,a
for(t.ads.includedCues={},o=0;o<e.length;o++){if(a=e[o],s=this.getSupportedAdCue(t,a),!this.isSupportedAdCue(t,a))return void c.log.warn("Skipping as this is not a supported ad cue.",a)
if(r=this.getCueId(t,a),a=a.startTime,W(t,r))return void c.log("Skipping ad already seen with ID "+r)
i&&i(t,s,r,a),n(t,s,r,a),N(t,r)}}},m=c,F=(t={isMiddlewareMediatorSupported:function(){return!m.browser.IS_IOS&&!m.browser.IS_ANDROID&&!!(m.use&&m.middleware&&m.middleware.TERMINATOR)},playMiddleware:function(n){return{setSource:function(t,e){e(null,t)},callPlay:function(){if(n.ads&&!0===n.ads._shouldBlockPlay)return n.ads.debug("Using playMiddleware to block content playback"),n.ads._playBlocked=!0,m.middleware.TERMINATOR},play:function(t,e){n.ads&&n.ads._playBlocked&&t?(n.ads.debug("Play call to Tech was terminated."),n.trigger("play"),n.addClass("vjs-has-started"),n.ads._playBlocked=!1):e&&e.catch&&e.catch(function(t){"NotAllowedError"!==t.name||c.browser.IS_SAFARI||n.trigger("pause")})}}},testHook:function(t){m=t}}).playMiddleware,U=t.isMiddlewareMediatorSupported,O=function(){var t
return c.getPlugin?Boolean(c.getPlugin("ads")):(t=c.getComponent("Player"),Boolean(t&&t.prototype.ads))},b.getState=function(t){return t&&b.states_&&b.states_[t]?b.states_[t]:void 0},b.registerState=function(t,e){if("string"==typeof t&&t)return(b.states_=b.states_?b.states_:{})[t]=e
throw new Error('Illegal state name, "'+t+'"; must be a non-empty string.')},f=b,k._getName=function(){return"Anonymous State"},(C=k.prototype).transitionTo=function(t){var e,n,i,o=this.player
for(this.cleanup(o),t=new t(o),o.ads._state=t,o.ads.debug(this.constructor._getName()+" -> "+t.constructor._getName()),e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i]
t.init.apply(t,[o].concat(n))},C.init=function(){},C.cleanup=function(){},C.onPlay=function(){},C.onPlaying=function(){},C.onEnded=function(){},C.onAdEnded=function(){},C.onAdsReady=function(){c.log.warn("Unexpected adsready event")},C.onAdsError=function(){},C.onAdsCanceled=function(){},C.onAdTimeout=function(){},C.onAdStarted=function(){},C.onContentChanged=function(){},C.onContentResumed=function(){},C.onReadyForPostroll=function(){c.log.warn("Unexpected readyforpostroll event")},C.onNoPreroll=function(){},C.onNoPostroll=function(){},C.startLinearAdMode=function(){c.log.warn("Unexpected startLinearAdMode invocation (State via "+this.constructor._getName()+")")},C.endLinearAdMode=function(){c.log.warn("Unexpected endLinearAdMode invocation (State via "+this.constructor._getName()+")")},C.skipLinearAdMode=function(){c.log.warn("Unexpected skipLinearAdMode invocation (State via "+this.constructor._getName()+")")},C.isAdState=function(){throw new Error("isAdState unimplemented for "+this.constructor._getName())},C.isWaitingForAdBreak=function(){return!1},C.isContentResuming=function(){return!1},C.inAdBreak=function(){return!1},C.handleEvent=function(t){var e=this.player
"play"===t?this.onPlay(e):"adsready"===t?this.onAdsReady(e):"adserror"===t?this.onAdsError(e):"adscanceled"===t?this.onAdsCanceled(e):"adtimeout"===t?this.onAdTimeout(e):"ads-ad-started"===t?this.onAdStarted(e):"contentchanged"===t?this.onContentChanged(e):"contentresumed"===t?this.onContentResumed(e):"readyforpostroll"===t?this.onReadyForPostroll(e):"playing"===t?this.onPlaying(e):"ended"===t?this.onEnded(e):"nopreroll"===t?this.onNoPreroll(e):"nopostroll"===t?this.onNoPostroll(e):"adended"===t&&this.onAdEnded(e)},f.registerState("State",C=k),L(E,H=C),(S=E.prototype).isAdState=function(){return!0},S.onPlaying=function(){var t=f.getState("ContentPlayback")
this.contentResuming&&this.transitionTo(t)},S.onContentResumed=function(){var t=f.getState("ContentPlayback")
this.contentResuming&&this.transitionTo(t)},S.isWaitingForAdBreak=function(){return this.waitingForAdBreak},S.isContentResuming=function(){return this.contentResuming},S.inAdBreak=function(){return!0===this.player.ads._inLinearAdMode},f.registerState("AdState",E),L(T,z=C),(S=T.prototype).isAdState=function(){return!1},S.onContentChanged=function(t){var e=f.getState("BeforePreroll"),n=f.getState("Preroll")
t.ads.debug("Received contentchanged event (ContentState)"),t.paused()?this.transitionTo(e):(this.transitionTo(n,!1),t.pause(),t.ads._pausedOnContentupdate=!0)},f.registerState("ContentState",T),L(M,K=f.getState("ContentState")),M._getName=function(){return"AdsDone"},(C=M.prototype).init=function(t){t.ads._contentHasEnded=!0,t.trigger("ended")},C.startLinearAdMode=function(){c.log.warn("Unexpected startLinearAdMode invocation (AdsDone)")},f.registerState("AdsDone",M),A=function(t){t.ads.debug("Starting ad break"),t.ads._inLinearAdMode=!0,t.trigger("adstart"),t.ads.shouldTakeSnapshots()&&(t.ads.snapshot=function(t){var e,n,i=c.browser.IS_IOS&&t.ads.isLive(t)&&0<t.seekable().length?t.currentTime()-t.seekable().end(0):t.currentTime(),o=t.$(".vjs-tech"),s=t.textTracks?t.textTracks():[],r=[],i={ended:t.ended(),currentSrc:t.currentSrc(),sources:t.currentSources(),src:t.tech_.src(),currentTime:i,type:t.currentType()}
for(o&&(i.style=o.getAttribute("style")),e=0;e<s.length;e++)n=s[e],r.push({track:n,mode:n.mode}),n.mode="disabled"
return i.suppressedTracks=r,i}(t)),t.ads.shouldPlayContentBehindAd(t)&&(t.ads.preAdVolume_=t.volume(),t.volume(0)),t.addClass("vjs-ad-playing"),t.hasClass("vjs-live")&&t.removeClass("vjs-live"),t.ads.removeNativePoster()},P=function(t,e){var n,i,o,s,r,a,d,l,h,u
t.ads.debug("Ending ad break"),void 0===e&&(e=function(){}),t.ads.adType=null,t.ads._inLinearAdMode=!1,t.trigger("adend"),t.removeClass("vjs-ad-playing"),t.ads.isLive(t)&&t.addClass("vjs-live"),t.ads.shouldTakeSnapshots()?(i=e,u=(n=t).ads.snapshot,void 0===i&&(i=function(){}),!0===n.ads.disableNextSnapshotRestore?(n.ads.disableNextSnapshotRestore=!1,delete n.ads.snapshot,i()):(s=n.$(".vjs-tech"),r=20,a=u.suppressedTracks,d=function(){for(var t=0;t<a.length;t++)(o=a[t]).track.mode=o.mode},l=function(){var t
c.browser.IS_IOS&&n.ads.isLive(n)?(u.currentTime<0&&(t=0<n.seekable().length?n.seekable().end(0)+u.currentTime:n.currentTime(),n.currentTime(t)),n.paused()&&(t=n.play())&&t.catch&&t.catch(function(t){c.log.warn("Play promise rejected in IOS snapshot resume",t)})):u.ended?n.currentTime(n.duration()):(n.currentTime(u.currentTime),(t=n.play())&&t.catch&&t.catch(function(t){c.log.warn("Play promise rejected in snapshot resume",t)})),n.ads.shouldRemoveAutoplay_&&(n.autoplay(!1),n.ads.shouldRemoveAutoplay_=!1)},h=function t(){if(n.off("contentcanplay",t),v&&n.clearTimeout(v),1<(s=n.el().querySelector(".vjs-tech")).readyState)return l()
if(void 0===s.seekable)return l()
if(0<s.seekable.length)return l()
if(r--)n.setTimeout(t,50)
else try{l()}catch(t){c.log.warn("Failed to resume the content after an advertisement",t)}},"style"in u&&s.setAttribute("style",u.style||""),n.ads.videoElementRecycled()?(n.one("resumeended",function(){delete n.ads.snapshot,i()}),n.one("contentloadedmetadata",d),c.browser.IS_IOS&&!n.autoplay()&&(n.autoplay(!0),n.ads.shouldRemoveAutoplay_=!0),n.src(u.sources),n.one("contentcanplay",h),v=n.setTimeout(h,2e3)):(d(),n.ended()||(h=n.play())&&h.catch&&h.catch(function(t){c.log.warn("Play promise rejected in snapshot restore",t)}),delete n.ads.snapshot,i()))):(t.volume(t.ads.preAdVolume_),e())},L(w,G=f.getState("AdState")),w._getName=function(){return"Preroll"},(S=w.prototype).init=function(t,e,n){if(this.waitingForAdBreak=!0,t.addClass("vjs-ad-loading"),n||t.ads.nopreroll_)return this.resumeAfterNoPreroll(t)
n=t.ads.settings.timeout
"number"==typeof t.ads.settings.prerollTimeout&&(n=t.ads.settings.prerollTimeout),this._timeout=t.setTimeout(function(){t.trigger("adtimeout")},n),e?this.handleAdsReady():this.adsReady=!1},S.onAdsReady=function(t){t.ads.inAdBreak()?c.log.warn("Unexpected adsready event (Preroll)"):(t.ads.debug("Received adsready event (Preroll)"),this.handleAdsReady())},S.handleAdsReady=function(){this.adsReady=!0,this.readyForPreroll()},S.afterLoadStart=function(t){var e=this.player
e.ads._hasThereBeenALoadStartDuringPlayerLife?t():(e.ads.debug("Waiting for loadstart..."),e.one("loadstart",function(){e.ads.debug("Received loadstart event"),t()}))},S.noPreroll=function(){var t=this
this.afterLoadStart(function(){t.player.ads.debug("Skipping prerolls due to nopreroll event (Preroll)"),t.resumeAfterNoPreroll(t.player)})},S.readyForPreroll=function(){var t=this.player
this.afterLoadStart(function(){t.ads.debug("Triggered readyforpreroll event (Preroll)"),t.trigger("readyforpreroll")})},S.onAdsCanceled=function(t){var e=this
t.ads.debug("adscanceled (Preroll)"),this.afterLoadStart(function(){e.resumeAfterNoPreroll(t)})},S.onAdsError=function(t){var e=this
c.log("adserror (Preroll)"),this.inAdBreak()?t.ads.endLinearAdMode():this.afterLoadStart(function(){e.resumeAfterNoPreroll(t)})},S.startLinearAdMode=function(){var t=this.player
!this.adsReady||t.ads.inAdBreak()||this.isContentResuming()?c.log.warn("Unexpected startLinearAdMode invocation (Preroll)"):(this.clearTimeout(t),t.ads.adType="preroll",this.waitingForAdBreak=!1,A(t),t.ads._shouldBlockPlay=!1)},S.onAdStarted=function(t){t.removeClass("vjs-ad-loading")},S.endLinearAdMode=function(){var t=this.player
this.inAdBreak()&&(t.removeClass("vjs-ad-loading"),t.addClass("vjs-ad-content-resuming"),this.contentResuming=!0,P(t))},S.skipLinearAdMode=function(){var t=this,e=this.player
e.ads.inAdBreak()||this.isContentResuming()?c.log.warn("Unexpected skipLinearAdMode invocation"):this.afterLoadStart(function(){e.trigger("adskip"),e.ads.debug("skipLinearAdMode (Preroll)"),t.resumeAfterNoPreroll(e)})},S.onAdTimeout=function(t){var e=this
this.afterLoadStart(function(){t.ads.debug("adtimeout (Preroll)"),e.resumeAfterNoPreroll(t)})},S.onNoPreroll=function(t){t.ads.inAdBreak()||this.isContentResuming()?c.log.warn("Unexpected nopreroll event (Preroll)"):this.noPreroll()},S.resumeAfterNoPreroll=function(t){var e
this.contentResuming=!0,t.ads._shouldBlockPlay=!1,this.cleanupPartial(t),(t.ads._playRequested||t.ads._pausedOnContentupdate)&&(t.paused()?(t.ads.debug("resumeAfterNoPreroll: attempting to resume playback (Preroll)"),(e=t.play())&&e.then&&e.then(null,function(t){})):(t.ads.debug("resumeAfterNoPreroll: already playing (Preroll)"),t.trigger("play"),t.trigger("playing")))},S.cleanup=function(t){t.ads._hasThereBeenALoadStartDuringPlayerLife||c.log.warn("Leaving Preroll state before loadstart event can cause issues."),this.cleanupPartial(t)},S.cleanupPartial=function(t){t.removeClass("vjs-ad-loading"),t.removeClass("vjs-ad-content-resuming"),this.clearTimeout(t)},S.clearTimeout=function(t){t.clearTimeout(this._timeout),this._timeout=null},f.registerState("Preroll",w),L(D,J=f.getState("ContentState")),D._getName=function(){return"BeforePreroll"},(C=D.prototype).init=function(t){this.adsReady=!1,this.shouldResumeToContent=!1,t.ads._shouldBlockPlay=!t.ads.settings.allowVjsAutoplay||!t.autoplay()},C.onAdsReady=function(t){t.ads.debug("Received adsready event (BeforePreroll)"),this.adsReady=!0},C.onPlay=function(t){var e=f.getState("Preroll")
t.ads.debug("Received play event (BeforePreroll)"),this.transitionTo(e,this.adsReady,this.shouldResumeToContent)},C.onAdsCanceled=function(t){t.ads.debug("adscanceled (BeforePreroll)"),this.shouldResumeToContent=!0},C.onAdsError=function(){this.player.ads.debug("adserror (BeforePreroll)"),this.shouldResumeToContent=!0},C.onNoPreroll=function(){this.player.ads.debug("Skipping prerolls due to nopreroll event (BeforePreroll)"),this.shouldResumeToContent=!0},C.skipLinearAdMode=function(){var t=this.player
t.trigger("adskip"),t.ads.debug("skipLinearAdMode (BeforePreroll)"),this.shouldResumeToContent=!0},C.onContentChanged=function(){this.init(this.player)},f.registerState("BeforePreroll",D),L(R,Y=f.getState("AdState")),R._getName=function(){return"Midroll"},(S=R.prototype).init=function(t){t.ads.adType="midroll",A(t),t.addClass("vjs-ad-loading")},S.onAdStarted=function(t){t.removeClass("vjs-ad-loading")},S.endLinearAdMode=function(){var t=this.player
this.inAdBreak()&&(this.contentResuming=!0,t.addClass("vjs-ad-content-resuming"),t.removeClass("vjs-ad-loading"),P(t))},S.onAdsError=function(t){this.inAdBreak()&&t.ads.endLinearAdMode()},S.cleanup=function(t){t.removeClass("vjs-ad-loading"),t.removeClass("vjs-ad-content-resuming")},f.registerState("Midroll",R),L(I,Z=f.getState("AdState")),I._getName=function(){return"Postroll"},(C=I.prototype).init=function(t){var e
this.waitingForAdBreak=!0,t.ads._contentEnding=!0,t.ads.nopostroll_?(this.resumeContent(t),e=f.getState("AdsDone"),this.transitionTo(e)):(t.addClass("vjs-ad-loading"),e=t.ads.settings.timeout,"number"==typeof t.ads.settings.postrollTimeout&&(e=t.ads.settings.postrollTimeout),this._postrollTimeout=t.setTimeout(function(){t.trigger("adtimeout")},e))},C.startLinearAdMode=function(){var t=this.player
t.ads.inAdBreak()||this.isContentResuming()?c.log.warn("Unexpected startLinearAdMode invocation (Postroll)"):(t.ads.adType="postroll",t.clearTimeout(this._postrollTimeout),this.waitingForAdBreak=!1,A(t))},C.onAdStarted=function(t){t.removeClass("vjs-ad-loading")},C.endLinearAdMode=function(){var t=this,e=this.player,n=f.getState("AdsDone")
this.inAdBreak()&&(e.removeClass("vjs-ad-loading"),this.resumeContent(e),P(e,function(){t.transitionTo(n)}))},C.skipLinearAdMode=function(){var t=this.player
t.ads.inAdBreak()||this.isContentResuming()?c.log.warn("Unexpected skipLinearAdMode invocation"):(t.ads.debug("Postroll abort (skipLinearAdMode)"),t.trigger("adskip"),this.abort(t))},C.onAdTimeout=function(t){t.ads.debug("Postroll abort (adtimeout)"),this.abort(t)},C.onAdsError=function(t){t.ads.debug("Postroll abort (adserror)"),t.ads.inAdBreak()?t.ads.endLinearAdMode():this.abort(t)},C.onContentChanged=function(t){var e
this.isContentResuming()?(e=f.getState("BeforePreroll"),this.transitionTo(e)):this.inAdBreak()||(e=f.getState("Preroll"),this.transitionTo(e))},C.onNoPostroll=function(t){this.isContentResuming()||this.inAdBreak()?c.log.warn("Unexpected nopostroll event (Postroll)"):this.abort(t)},C.resumeContent=function(t){this.contentResuming=!0,t.addClass("vjs-ad-content-resuming")},C.abort=function(t){var e=f.getState("AdsDone")
this.resumeContent(t),t.removeClass("vjs-ad-loading"),this.transitionTo(e)},C.cleanup=function(t){t.removeClass("vjs-ad-content-resuming"),t.clearTimeout(this._postrollTimeout),t.ads._contentEnding=!1},f.registerState("Postroll",I),L(j,$=f.getState("ContentState")),j._getName=function(){return"ContentPlayback"},(S=j.prototype).init=function(t){t.ads._shouldBlockPlay=!1},S.onAdsReady=function(t){t.ads.debug("Received adsready event (ContentPlayback)"),t.ads.nopreroll_||(t.ads.debug("Triggered readyforpreroll event (ContentPlayback)"),t.trigger("readyforpreroll"))},S.onReadyForPostroll=function(t){var e=f.getState("Postroll")
t.ads.debug("Received readyforpostroll event"),this.transitionTo(e)},S.startLinearAdMode=function(){var t=f.getState("Midroll")
this.transitionTo(t)},f.registerState("ContentPlayback",j),L(_,Q=f.getState("ContentState")),_._getName=function(){return"StitchedContentPlayback"},(C=_.prototype).init=function(){this.player.ads._shouldBlockPlay=!1},C.onContentChanged=function(){this.player.ads.debug("Received contentchanged event ("+this.constructor._getName()+")")},C.startLinearAdMode=function(){var t=f.getState("StitchedAdRoll")
this.transitionTo(t)},f.registerState("StitchedContentPlayback",_),L(B,X=f.getState("AdState")),B._getName=function(){return"StitchedAdRoll"},(S=B.prototype).init=function(){this.waitingForAdBreak=!1,this.contentResuming=!1,this.player.ads.adType="stitched",A(this.player)},S.onPlaying=function(){},S.onContentResumed=function(){},S.onAdEnded=function(){this.endLinearAdMode(),this.player.trigger("ended")},S.endLinearAdMode=function(){var t=f.getState("StitchedContentPlayback")
P(this.player),this.transitionTo(t)},f.registerState("StitchedAdRoll",B),V=t.isMiddlewareMediatorSupported,x=c.getTech("Html5").Events,q={timeout:5e3,prerollTimeout:void 0,postrollTimeout:void 0,debug:!1,stitchedAds:!1,contentIsLive:void 0,liveCuePoints:!0,allowVjsAutoplay:c.options.normalizeAutoplay||!1},(C=function(t){var e,n,i,o,s=this,t=c.mergeOptions(q,t),r=[]
x.concat(["firstplay","loadedalldata"]).forEach(function(t){-1===r.indexOf(t)&&r.push(t)}),s.on(r,tt),V()||(o=s,t.debug&&c.log("Using cancelContentPlay to block content playback"),o.on("play",et)),s.setTimeout(function(){s.ads._hasThereBeenALoadStartDuringPlayerLife||""===s.src()||c.log.error("videojs-contrib-ads has not seen a loadstart event 5 seconds after being initialized, but a source is present. This indicates that videojs-contrib-ads was initialized too late. It must be initialized immediately after video.js in the same tick. As a result, some ads will not play and some media events will be incorrect. For more information, see http://videojs.github.io/videojs-contrib-ads/integrator/getting-started.html")},5e3),s.on("ended",function(){s.hasClass("vjs-has-started")||s.addClass("vjs-has-started")}),s.on("contenttimeupdate",function(){s.removeClass("vjs-waiting")}),s.on(["addurationchange","adcanplay"],function(){var t
s.ads.settings.stitchedAds||s.hasStarted()||s.ads.snapshot&&s.currentSrc()===s.ads.snapshot.currentSrc||!s.ads.inAdBreak()||(t=s.play())&&t.catch&&t.catch(function(t){c.log.warn("Play promise rejected when playing ad",t)})}),s.on("nopreroll",function(){s.ads.debug("Received nopreroll event"),s.ads.nopreroll_=!0}),s.on("nopostroll",function(){s.ads.debug("Received nopostroll event"),s.ads.nopostroll_=!0}),s.on("playing",function(){s.ads._cancelledPlay=!1,s.ads._pausedOnContentupdate=!1}),s.on("play",function(){s.ads._playRequested=!0}),s.one("loadstart",function(){s.ads._hasThereBeenALoadStartDuringPlayerLife=!0}),s.on("loadeddata",function(){s.ads._hasThereBeenALoadedData=!0}),s.on("loadedmetadata",function(){s.ads._hasThereBeenALoadedMetaData=!0}),s.ads=(i=s,{disableNextSnapshotRestore:!1,_contentEnding:!1,_contentHasEnded:!1,_hasThereBeenALoadStartDuringPlayerLife:!1,_hasThereBeenALoadedData:!1,_hasThereBeenALoadedMetaData:!1,_inLinearAdMode:!1,_shouldBlockPlay:!1,_playBlocked:!1,_playRequested:!1,adType:null,VERSION:a,reset:function(){i.ads.disableNextSnapshotRestore=!1,i.ads._contentEnding=!1,i.ads._contentHasEnded=!1,i.ads.snapshot=null,i.ads.adType=null,i.ads._hasThereBeenALoadedData=!1,i.ads._hasThereBeenALoadedMetaData=!1,i.ads._cancelledPlay=!1,i.ads._shouldBlockPlay=!1,i.ads._playBlocked=!1,i.ads.nopreroll_=!1,i.ads.nopostroll_=!1,i.ads._playRequested=!1},startLinearAdMode:function(){i.ads._state.startLinearAdMode()},endLinearAdMode:function(){i.ads._state.endLinearAdMode()},skipLinearAdMode:function(){i.ads._state.skipLinearAdMode()},stitchedAds:function(t){return void 0!==t&&(c.log.warn("Using player.ads.stitchedAds() as a setter is deprecated, it should be set as an option upon initialization of contrib-ads."),this.settings.stitchedAds=!!t),this.settings.stitchedAds},videoElementRecycled:function(){if(i.ads.shouldPlayContentBehindAd(i))return!1
var t,e
if(this.snapshot)return t=i.tech_.src()!==this.snapshot.src,e=i.currentSrc()!==this.snapshot.currentSrc,t||e
throw new Error("You cannot use videoElementRecycled while there is no snapshot.")},isLive:function(t){return"boolean"==typeof(t=void 0===t?i:t).ads.settings.contentIsLive?t.ads.settings.contentIsLive:t.duration()===1/0||"8"===c.browser.IOS_VERSION&&0===t.duration()},shouldPlayContentBehindAd:function(t){if(t=void 0===t?i:t)return!!t.ads.settings.liveCuePoints&&!c.browser.IS_IOS&&!c.browser.IS_ANDROID&&t.duration()===1/0
throw new Error("shouldPlayContentBehindAd requires a player as a param")},shouldTakeSnapshots:function(t){return!this.shouldPlayContentBehindAd(t=void 0===t?i:t)&&!this.stitchedAds()},isInAdMode:function(){return this._state.isAdState()},isWaitingForAdBreak:function(){return this._state.isWaitingForAdBreak()},isContentResuming:function(){return this._state.isContentResuming()},isAdPlaying:function(){return this._state.inAdBreak()},inAdBreak:function(){return this._state.inAdBreak()},removeNativePoster:function(){var t=i.$(".vjs-tech")
t&&t.removeAttribute("poster")},debug:function(){if(this.settings.debug){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n]
1===e.length&&"string"==typeof e[0]?c.log("ADS: "+e[0]):c.log.apply(c,["ADS:"].concat(e))}}}),(s.ads.settings=t).stitchedAds=!!t.stitchedAds,t.stitchedAds?s.ads._state=new(f.getState("StitchedContentPlayback"))(s):s.ads._state=new(f.getState("BeforePreroll"))(s),s.ads._state.init(s),s.ads.cueTextTracks=y,s.ads.adMacroReplacement=function(t,a,e){var n,i,o,s=this,d={}
for(i in t=t.replace(/{([^}=]+)=([^}]+)}/g,function(t,e,n){return d["{"+e+"}"]=n,"{"+e+"}"}),void 0===a&&(a=!1),n={},(n=void 0!==e?e:n)["{player.id}"]=this.options_["data-player"]||this.id_,n["{player.height}"]=this.currentHeight(),n["{player.width}"]=this.currentWidth(),n["{mediainfo.id}"]=this.mediainfo?this.mediainfo.id:"",n["{mediainfo.name}"]=this.mediainfo?this.mediainfo.name:"",n["{mediainfo.duration}"]=this.mediainfo?this.mediainfo.duration:"",n["{player.duration}"]=this.duration(),n["{player.pageUrl}"]=c.dom.isInFrame()?h.referrer:l.location.href,n["{playlistinfo.id}"]=this.playlistinfo?this.playlistinfo.id:"",n["{playlistinfo.name}"]=this.playlistinfo?this.playlistinfo.name:"",n["{timestamp}"]=(new Date).getTime(),n["{document.referrer}"]=h.referrer,n["{window.location.href}"]=l.location.href,n["{random}"]=Math.floor(1e12*Math.random()),["description","tags","reference_id","ad_keys"].forEach(function(t){s.mediainfo&&s.mediainfo[t]?n["{mediainfo."+t+"}"]=s.mediainfo[t]:n["{mediainfo."+t+"}"]=d["{mediainfo."+t+"}"]||""}),g(this.mediainfo,n,"custom_fields"),g(this.mediainfo,n,"customFields"),Object.keys(u).forEach(function(t){n["{tcf."+t+"}"]=u[t]}),n["{tcf.gdprAppliesInt}"]=u.gdprApplies?1:0,n)t=t.split(i).join(p(n[i],a))
for(o in t=t.replace(/{pageVariable\.([^}]+)}/g,function(t,e){for(var n,i,o=l,s=e.split("."),r=0;r<s.length;r++)r===s.length-1?n=o[s[r]]:o=o[s[r]]
return i=typeof n,null===n?"null":void 0===n?d["{pageVariable."+e+"}"]||(c.log.warn('Page variable "'+e+'" not found'),""):"string"!=i&&"number"!=i&&"boolean"!=i?(c.log.warn('Page variable "'+e+'" is not a supported type'),""):p(String(n),a)}),d)t=t.replace(o,d[o])
return t}.bind(s),(n=s).ads.contentSrc=n.currentSrc(),n.ads._seenInitialLoadstart=!1,n.on("loadstart",function(){var t
n.ads.inAdBreak()||((t=n.currentSrc())!==n.ads.contentSrc&&(n.ads._seenInitialLoadstart&&n.trigger({type:"contentchanged"}),n.trigger({type:"contentupdate",oldValue:n.ads.contentSrc,newValue:t}),n.ads.contentSrc=t),n.ads._seenInitialLoadstart=!0)}),s.on("contentchanged",s.ads.reset),e=function(){var t,e,n=s.textTracks()
if(!s.ads.shouldPlayContentBehindAd(s)&&s.ads.inAdBreak()&&s.tech_.featuresNativeTextTracks&&c.browser.IS_IOS&&!Array.isArray(s.textTracks()))for(t=0;t<n.length;t++)"showing"===(e=n[t]).mode&&(e.mode="disabled")},s.ready(function(){s.textTracks().addEventListener("change",e)}),s.on(["play","playing","ended","adsready","adscanceled","adskip","adserror","adtimeout","adended","ads-ad-started","contentchanged","dispose","contentresumed","readyforpostroll","nopreroll","nopostroll"],function(t){s.ads._state.handleEvent(t.type)}),s.on("dispose",function(){s.ads.reset(),s.textTracks().removeEventListener("change",e)}),d(),s.ads.listenToTcf=d}).VERSION=a,S=C,O()||((c.registerPlugin||c.plugin)("ads",S),!U())||c.usingContribAdsMiddleware_||(c.use("*",F),c.usingContribAdsMiddleware_=!0,c.log.debug("Play middleware has been registered with videojs")),C}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("video.js")):"function"==typeof define&&define.amd?define(["exports","video.js"],e):e(t.videojsIma={},t.videojs)}(this,function(t,e){"use strict"
var i,o,n,s,r,a,d,l,h,u,c,p,g,y
function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e=e&&e.hasOwnProperty("default")?e.default:e,(i=function(t,e,n){this.vjsPlayer=t,this.controller=n,this.contentTrackingTimer=null,this.contentComplete=!1,this.updateTimeIntervalHandle=null,this.updateTimeInterval=1e3,this.seekCheckIntervalHandle=null,this.seekCheckInterval=1e3,this.resizeCheckIntervalHandle=null,this.resizeCheckInterval=250,this.seekThreshold=100,this.contentEndedListeners=[],this.contentSource="",this.contentSourceType="",this.contentPlayheadTracker={currentTime:0,previousTime:0,seeking:!1,duration:0},this.vjsPlayerDimensions={width:this.getPlayerWidth(),height:this.getPlayerHeight()},this.vjsControls=this.vjsPlayer.getChild("controlBar"),this.h5Player=null,this.vjsPlayer.one("play",this.setUpPlayerIntervals.bind(this)),this.boundContentEndedListener=this.localContentEndedListener.bind(this),this.vjsPlayer.on("contentended",this.boundContentEndedListener),this.vjsPlayer.on("dispose",this.playerDisposedListener.bind(this)),this.vjsPlayer.on("readyforpreroll",this.onReadyForPreroll.bind(this)),this.vjsPlayer.on("adtimeout",this.onAdTimeout.bind(this)),this.vjsPlayer.ready(this.onPlayerReady.bind(this)),"onPlay"===this.controller.getSettings().requestMode&&this.vjsPlayer.one("play",this.controller.requestAds.bind(this.controller)),this.vjsPlayer.ads(e)}).prototype.setUpPlayerIntervals=function(){this.updateTimeIntervalHandle=setInterval(this.updateCurrentTime.bind(this),this.updateTimeInterval),this.seekCheckIntervalHandle=setInterval(this.checkForSeeking.bind(this),this.seekCheckInterval),this.resizeCheckIntervalHandle=setInterval(this.checkForResize.bind(this),this.resizeCheckInterval)},i.prototype.updateCurrentTime=function(){this.contentPlayheadTracker.seeking||(this.contentPlayheadTracker.currentTime=this.vjsPlayer.currentTime())},i.prototype.checkForSeeking=function(){var t=1e3*(this.vjsPlayer.currentTime()-this.contentPlayheadTracker.previousTime)
Math.abs(t)>this.seekCheckInterval+this.seekThreshold?this.contentPlayheadTracker.seeking=!0:this.contentPlayheadTracker.seeking=!1,this.contentPlayheadTracker.previousTime=this.vjsPlayer.currentTime()},i.prototype.checkForResize=function(){var t=this.getPlayerWidth(),e=this.getPlayerHeight()
t==this.vjsPlayerDimensions.width&&e==this.vjsPlayerDimensions.height||(this.vjsPlayerDimensions.width=t,this.vjsPlayerDimensions.height=e,this.controller.onPlayerResize(t,e))},i.prototype.localContentEndedListener=function(){for(var t in this.contentComplete||(this.contentComplete=!0,this.controller.onContentComplete()),this.contentEndedListeners)"function"==typeof this.contentEndedListeners[t]&&this.contentEndedListeners[t]()
clearInterval(this.updateTimeIntervalHandle),clearInterval(this.seekCheckIntervalHandle),clearInterval(this.resizeCheckIntervalHandle),this.vjsPlayer.el()&&this.vjsPlayer.one("play",this.setUpPlayerIntervals.bind(this))},i.prototype.onNoPostroll=function(){this.vjsPlayer.trigger("nopostroll")},i.prototype.playerDisposedListener=function(){var t,e
for(e in this.contentEndedListeners=[],this.controller.onPlayerDisposed(),this.contentComplete=!0,this.vjsPlayer.off("contentended",this.boundContentEndedListener),this.vjsPlayer.ads.adTimeoutTimeout&&clearTimeout(this.vjsPlayer.ads.adTimeoutTimeout),t=[this.updateTimeIntervalHandle,this.seekCheckIntervalHandle,this.resizeCheckIntervalHandle])t[e]&&clearInterval(t[e])},i.prototype.onReadyForPreroll=function(){this.controller.onPlayerReadyForPreroll()},i.prototype.onAdTimeout=function(){this.controller.onAdTimeout()},i.prototype.onPlayerReady=function(){this.h5Player=document.getElementById(this.getPlayerId()).getElementsByClassName("vjs-tech")[0],this.h5Player.hasAttribute("autoplay")&&this.controller.setSetting("adWillAutoPlay",!0),this.onVolumeChange(),this.vjsPlayer.on("fullscreenchange",this.onFullscreenChange.bind(this)),this.vjsPlayer.on("volumechange",this.onVolumeChange.bind(this)),this.controller.onPlayerReady()},i.prototype.onFullscreenChange=function(){this.vjsPlayer.isFullscreen()?this.controller.onPlayerEnterFullscreen():this.controller.onPlayerExitFullscreen()},i.prototype.onVolumeChange=function(){var t=this.vjsPlayer.muted()?0:this.vjsPlayer.volume()
this.controller.onPlayerVolumeChanged(t)},i.prototype.injectAdContainerDiv=function(t){this.vjsControls.el().parentNode.appendChild(t)},i.prototype.getContentPlayer=function(){return this.h5Player},i.prototype.getVolume=function(){return this.vjsPlayer.muted()?0:this.vjsPlayer.volume()},i.prototype.setVolume=function(t){this.vjsPlayer.volume(t),0==t?this.vjsPlayer.muted(!0):this.vjsPlayer.muted(!1)},i.prototype.unmute=function(){this.vjsPlayer.muted(!1)},i.prototype.mute=function(){this.vjsPlayer.muted(!0)},i.prototype.play=function(){this.vjsPlayer.play()},i.prototype.togglePlayback=function(){this.vjsPlayer.paused()?this.vjsPlayer.play():this.vjsPlayer.pause()},i.prototype.getPlayerWidth=function(){var t=(getComputedStyle(this.vjsPlayer.el())||{}).width
return t&&0!==parseFloat(t)||(t=(this.vjsPlayer.el().getBoundingClientRect()||{}).width),parseFloat(t)||this.vjsPlayer.width()},i.prototype.getPlayerHeight=function(){var t=(getComputedStyle(this.vjsPlayer.el())||{}).height
return t&&0!==parseFloat(t)||(t=(this.vjsPlayer.el().getBoundingClientRect()||{}).height),parseFloat(t)||this.vjsPlayer.height()},i.prototype.getPlayerOptions=function(){return this.vjsPlayer.options_},i.prototype.getPlayerId=function(){return this.vjsPlayer.id()},i.prototype.toggleFullscreen=function(){this.vjsPlayer.isFullscreen()?this.vjsPlayer.exitFullscreen():this.vjsPlayer.requestFullscreen()},i.prototype.getContentPlayheadTracker=function(){return this.contentPlayheadTracker},i.prototype.onAdError=function(t){this.vjsControls.show()
var e=void 0!==t.getError?t.getError():t.stack
this.vjsPlayer.trigger({type:"adserror",data:{AdError:e,AdErrorEvent:t}})},i.prototype.onAdLog=function(t){var e=t.getAdData(),e=void 0!==e.adError?e.adError.getMessage():void 0
this.vjsPlayer.trigger({type:"adslog",data:{AdError:e,AdEvent:t}})},i.prototype.onAdBreakStart=function(){this.contentSource=this.vjsPlayer.currentSrc(),this.contentSourceType=this.vjsPlayer.currentType(),this.vjsPlayer.off("contentended",this.boundContentEndedListener),this.vjsPlayer.ads.startLinearAdMode(),this.vjsControls.hide(),this.vjsPlayer.pause()},i.prototype.onAdBreakEnd=function(){this.vjsPlayer.on("contentended",this.boundContentEndedListener),this.vjsPlayer.ads.inAdBreak()&&this.vjsPlayer.ads.endLinearAdMode(),this.vjsControls.show()},i.prototype.onAdStart=function(){this.vjsPlayer.trigger("ads-ad-started")},i.prototype.onAllAdsCompleted=function(){1==this.contentComplete&&(this.contentSource&&this.vjsPlayer.currentSrc()!=this.contentSource&&this.vjsPlayer.src({src:this.contentSource,type:this.contentSourceType}),this.controller.onContentAndAdsCompleted())},i.prototype.onAdsReady=function(){this.vjsPlayer.trigger("adsready")},i.prototype.changeSource=function(t){this.vjsPlayer.currentSrc()&&(this.vjsPlayer.currentTime(0),this.vjsPlayer.pause()),t&&this.vjsPlayer.src(t),this.vjsPlayer.one("loadedmetadata",this.seekContentToZero.bind(this))},i.prototype.seekContentToZero=function(){this.vjsPlayer.currentTime(0)},i.prototype.triggerPlayerEvent=function(t,e){this.vjsPlayer.trigger(t,e)},i.prototype.addContentEndedListener=function(t){this.contentEndedListeners.push(t)},i.prototype.reset=function(){this.vjsPlayer.off("contentended",this.boundContentEndedListener),this.vjsPlayer.on("contentended",this.boundContentEndedListener),this.vjsControls.show(),this.vjsPlayer.ads.inAdBreak()&&this.vjsPlayer.ads.endLinearAdMode(),this.contentPlayheadTracker.currentTime=0,this.contentComplete=!1},(o=function(t){this.controller=t,this.adContainerDiv=document.createElement("div"),this.controlsDiv=document.createElement("div"),this.countdownDiv=document.createElement("div"),this.seekBarDiv=document.createElement("div"),this.progressDiv=document.createElement("div"),this.playPauseDiv=document.createElement("div"),this.muteDiv=document.createElement("div"),this.sliderDiv=document.createElement("div"),this.sliderLevelDiv=document.createElement("div"),this.fullscreenDiv=document.createElement("div"),this.boundOnMouseUp=this.onMouseUp.bind(this),this.boundOnMouseMove=this.onMouseMove.bind(this),this.adPlayheadTracker={currentTime:0,duration:0,isPod:!1,adPosition:0,totalAds:0},this.controlPrefix=this.controller.getPlayerId()+"_",!(this.showCountdown=!0)===this.controller.getSettings().showCountdown&&(this.showCountdown=!1),this.isAdNonlinear=!1,this.createAdContainer()}).prototype.createAdContainer=function(){this.assignControlAttributes(this.adContainerDiv,"ima-ad-container"),this.adContainerDiv.style.position="absolute",this.adContainerDiv.style.zIndex=1111,this.adContainerDiv.addEventListener("mouseenter",this.showAdControls.bind(this),!1),this.adContainerDiv.addEventListener("mouseleave",this.hideAdControls.bind(this),!1),this.adContainerDiv.addEventListener("click",this.onAdContainerClick.bind(this),!1),this.createControls(),this.controller.injectAdContainerDiv(this.adContainerDiv)},o.prototype.createControls=function(){this.assignControlAttributes(this.controlsDiv,"ima-controls-div"),this.controlsDiv.style.width="100%",this.controller.getIsMobile()?this.countdownDiv.style.display="none":(this.assignControlAttributes(this.countdownDiv,"ima-countdown-div"),this.countdownDiv.innerHTML=this.controller.getSettings().adLabel,this.countdownDiv.style.display=this.showCountdown?"block":"none"),this.assignControlAttributes(this.seekBarDiv,"ima-seek-bar-div"),this.seekBarDiv.style.width="100%",this.assignControlAttributes(this.progressDiv,"ima-progress-div"),this.assignControlAttributes(this.playPauseDiv,"ima-play-pause-div"),this.addClass(this.playPauseDiv,"ima-playing"),this.playPauseDiv.addEventListener("click",this.onAdPlayPauseClick.bind(this),!1),this.assignControlAttributes(this.muteDiv,"ima-mute-div"),this.addClass(this.muteDiv,"ima-non-muted"),this.muteDiv.addEventListener("click",this.onAdMuteClick.bind(this),!1),this.assignControlAttributes(this.sliderDiv,"ima-slider-div"),this.sliderDiv.addEventListener("mousedown",this.onAdVolumeSliderMouseDown.bind(this),!1),this.controller.getIsIos()&&(this.sliderDiv.style.display="none"),this.assignControlAttributes(this.sliderLevelDiv,"ima-slider-level-div"),this.assignControlAttributes(this.fullscreenDiv,"ima-fullscreen-div"),this.addClass(this.fullscreenDiv,"ima-non-fullscreen"),this.fullscreenDiv.addEventListener("click",this.onAdFullscreenClick.bind(this),!1),this.adContainerDiv.appendChild(this.controlsDiv),this.controlsDiv.appendChild(this.countdownDiv),this.controlsDiv.appendChild(this.seekBarDiv),this.controlsDiv.appendChild(this.playPauseDiv),this.controlsDiv.appendChild(this.muteDiv),this.controlsDiv.appendChild(this.sliderDiv),this.controlsDiv.appendChild(this.fullscreenDiv),this.seekBarDiv.appendChild(this.progressDiv),this.sliderDiv.appendChild(this.sliderLevelDiv)},o.prototype.onAdPlayPauseClick=function(){this.controller.onAdPlayPauseClick()},o.prototype.onAdMuteClick=function(){this.controller.onAdMuteClick()},o.prototype.onAdFullscreenClick=function(){this.controller.toggleFullscreen()},o.prototype.onAdsPaused=function(){this.controller.sdkImpl.adPlaying=!1,this.addClass(this.playPauseDiv,"ima-paused"),this.removeClass(this.playPauseDiv,"ima-playing"),this.showAdControls()},o.prototype.onAdsResumed=function(){this.onAdsPlaying(),this.showAdControls()},o.prototype.onAdsPlaying=function(){this.controller.sdkImpl.adPlaying=!0,this.addClass(this.playPauseDiv,"ima-playing"),this.removeClass(this.playPauseDiv,"ima-paused")},o.prototype.updateAdUi=function(t,e,n,i,o){var s,r=Math.floor(e/60),e=Math.floor(e%60)
e.toString().length<2&&(e="0"+e),s=": ",1<o&&(s=" ("+i+" "+this.controller.getSettings().adLabelNofN+" "+o+"): "),this.countdownDiv.innerHTML=this.controller.getSettings().adLabel+s+r+":"+e,this.progressDiv.style.width=100*(t/n)+"%"},o.prototype.unmute=function(){this.addClass(this.muteDiv,"ima-non-muted"),this.removeClass(this.muteDiv,"ima-muted"),this.sliderLevelDiv.style.width=100*this.controller.getPlayerVolume()+"%"},o.prototype.mute=function(){this.addClass(this.muteDiv,"ima-muted"),this.removeClass(this.muteDiv,"ima-non-muted"),this.sliderLevelDiv.style.width="0%"},o.prototype.onAdVolumeSliderMouseDown=function(){document.addEventListener("mouseup",this.boundOnMouseUp,!1),document.addEventListener("mousemove",this.boundOnMouseMove,!1)},o.prototype.onMouseMove=function(t){this.changeVolume(t)},o.prototype.onMouseUp=function(t){this.changeVolume(t),document.removeEventListener("mouseup",this.boundOnMouseUp),document.removeEventListener("mousemove",this.boundOnMouseMove)},o.prototype.changeVolume=function(t){t=(t.clientX-this.sliderDiv.getBoundingClientRect().left)/this.sliderDiv.offsetWidth
t*=100,t=Math.min(Math.max(t,0),100),this.sliderLevelDiv.style.width=t+"%",0==this.percent?(this.addClass(this.muteDiv,"ima-muted"),this.removeClass(this.muteDiv,"ima-non-muted")):(this.addClass(this.muteDiv,"ima-non-muted"),this.removeClass(this.muteDiv,"ima-muted")),this.controller.setVolume(t/100)},o.prototype.showAdContainer=function(){this.adContainerDiv.style.display="block"},o.prototype.hideAdContainer=function(){this.adContainerDiv.style.display="none"},o.prototype.onAdContainerClick=function(){this.isAdNonlinear&&this.controller.togglePlayback()},o.prototype.reset=function(){this.hideAdContainer()},o.prototype.onAdError=function(){this.hideAdContainer()},o.prototype.onAdBreakStart=function(t){this.showAdContainer(),"application/javascript"!==t.getAd().getContentType()||this.controller.getSettings().showControlsForJSAds?this.controlsDiv.style.display="block":this.controlsDiv.style.display="none",this.onAdsPlaying(),this.hideAdControls()},o.prototype.onAdBreakEnd=function(){var t=this.controller.getCurrentAd()
null!=t&&!t.isLinear()||this.hideAdContainer(),this.controlsDiv.style.display="none",this.countdownDiv.innerHTML=""},o.prototype.onAllAdsCompleted=function(){this.hideAdContainer()},o.prototype.onLinearAdStart=function(){this.removeClass(this.adContainerDiv,"bumpable-ima-ad-container"),this.isAdNonlinear=!1},o.prototype.onNonLinearAdLoad=function(){this.adContainerDiv.style.display="block",this.addClass(this.adContainerDiv,"bumpable-ima-ad-container"),this.isAdNonlinear=!0},o.prototype.onPlayerEnterFullscreen=function(){this.addClass(this.fullscreenDiv,"ima-fullscreen"),this.removeClass(this.fullscreenDiv,"ima-non-fullscreen")},o.prototype.onPlayerExitFullscreen=function(){this.addClass(this.fullscreenDiv,"ima-non-fullscreen"),this.removeClass(this.fullscreenDiv,"ima-fullscreen")},o.prototype.onPlayerVolumeChanged=function(t){0==t?(this.addClass(this.muteDiv,"ima-muted"),this.removeClass(this.muteDiv,"ima-non-muted"),this.sliderLevelDiv.style.width="0%"):(this.addClass(this.muteDiv,"ima-non-muted"),this.removeClass(this.muteDiv,"ima-muted"),this.sliderLevelDiv.style.width=100*t+"%")},o.prototype.showAdControls=function(){this.controller.getSettings().disableAdControls||this.addClass(this.controlsDiv,"ima-controls-div-showing")},o.prototype.hideAdControls=function(){this.removeClass(this.controlsDiv,"ima-controls-div-showing")},o.prototype.assignControlAttributes=function(t,e){t.id=this.controlPrefix+e,t.className=this.controlPrefix+e+" "+e},o.prototype.getClassRegexp=function(t){return new RegExp("(^|[^A-Za-z-])"+t+"((?![A-Za-z-])|$)","gi")},o.prototype.elementHasClass=function(t,e){return this.getClassRegexp(e).test(t.className)},o.prototype.addClass=function(t,e){t.className=t.className.trim()+" "+e},o.prototype.removeClass=function(t,e){e=this.getClassRegexp(e)
t.className=t.className.trim().replace(e,"")},o.prototype.getAdContainerDiv=function(){return this.adContainerDiv},o.prototype.setShowCountdown=function(t){this.showCountdown=t,this.countdownDiv.style.display=this.showCountdown?"block":"none"},n="2.1.0",s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},(r=function(t){this.controller=t,this.adDisplayContainer=null,this.adDisplayContainerInitialized=!1,this.adsLoader=null,this.adsManager=null,this.adsRenderingSettings=null,this.adsResponse=null,this.currentAd=null,this.adTrackingTimer=null,this.allAdsCompleted=!1,this.adsActive=!1,this.adPlaying=!1,this.adMuted=!1,this.adBreakReadyListener=void 0,this.contentCompleteCalled=!1,this.isAdTimedOut=!1,this.adsManagerDimensions={width:0,height:0},!(this.autoPlayAdBreaks=!0)===this.controller.getSettings().autoPlayAdBreaks&&(this.autoPlayAdBreaks=!1),this.controller.getSettings().locale&&google.ima.settings.setLocale(this.controller.getSettings().locale),this.controller.getSettings().disableFlashAds&&google.ima.settings.setDisableFlashAds(this.controller.getSettings().disableFlashAds),this.controller.getSettings().disableCustomPlaybackForIOS10Plus&&google.ima.settings.setDisableCustomPlaybackForIOS10Plus(this.controller.getSettings().disableCustomPlaybackForIOS10Plus),this.controller.getSettings().ppid&&google.ima.settings.setPpid(this.controller.getSettings().ppid),this.controller.getSettings().featureFlags&&google.ima.settings.setFeatureFlags(this.controller.getSettings().featureFlags)}).prototype.initAdObjects=function(){this.adDisplayContainer=new google.ima.AdDisplayContainer(this.controller.getAdContainerDiv(),this.controller.getContentPlayer()),this.adsLoader=new google.ima.AdsLoader(this.adDisplayContainer),this.adsLoader.getSettings().setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),0==this.controller.getSettings().vpaidAllowed&&this.adsLoader.getSettings().setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.DISABLED),void 0!==this.controller.getSettings().vpaidMode&&this.adsLoader.getSettings().setVpaidMode(this.controller.getSettings().vpaidMode),this.controller.getSettings().locale&&this.adsLoader.getSettings().setLocale(this.controller.getSettings().locale),this.controller.getSettings().numRedirects&&this.adsLoader.getSettings().setNumRedirects(this.controller.getSettings().numRedirects),this.controller.getSettings().sessionId&&this.adsLoader.getSettings().setSessionId(this.controller.getSettings().sessionId),this.adsLoader.getSettings().setPlayerType("videojs-ima"),this.adsLoader.getSettings().setPlayerVersion(n),this.adsLoader.getSettings().setAutoPlayAdBreaks(this.autoPlayAdBreaks),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdsLoaderError.bind(this),!1),this.controller.playerWrapper.vjsPlayer.trigger({type:"ads-loader",adsLoader:this.adsLoader})},r.prototype.requestAds=function(){var e,n,i=new google.ima.AdsRequest
this.controller.getSettings().adTagUrl?i.adTagUrl=this.controller.getSettings().adTagUrl:i.adsResponse=this.controller.getSettings().adsResponse,this.controller.getSettings().forceNonLinearFullSlot&&(i.forceNonLinearFullSlot=!0),this.controller.getSettings().vastLoadTimeout&&(i.vastLoadTimeout=this.controller.getSettings().vastLoadTimeout),this.controller.getSettings().omidMode&&window.console.warn("The additional setting `omidMode` has been removed. Use `omidVendorAccess` instead."),this.controller.getSettings().omidVendorAccess&&(i.omidAccessModeRules={},e=this.controller.getSettings().omidVendorAccess,Object.keys(e).forEach(function(t){i.omidAccessModeRules[t]=e[t]})),i.linearAdSlotWidth=this.controller.getPlayerWidth(),i.linearAdSlotHeight=this.controller.getPlayerHeight(),i.nonLinearAdSlotWidth=this.controller.getSettings().nonLinearWidth||this.controller.getPlayerWidth(),i.nonLinearAdSlotHeight=this.controller.getSettings().nonLinearHeight||this.controller.getPlayerHeight(),i.setAdWillAutoPlay(this.controller.adsWillAutoplay()),i.setAdWillPlayMuted(this.controller.adsWillPlayMuted()),(n=this.controller.getSettings().adsRequest)&&"object"===(void 0===n?"undefined":s(n))&&Object.keys(n).forEach(function(t){i[t]=n[t]}),this.adsLoader.requestAds(i),this.controller.playerWrapper.vjsPlayer.trigger({type:"ads-request",AdsRequest:i})},r.prototype.onAdsManagerLoaded=function(t){this.createAdsRenderingSettings(),this.adsManager=t.getAdsManager(this.controller.getContentPlayheadTracker(),this.adsRenderingSettings),this.adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.AD_BREAK_READY,this.onAdBreakReady.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this.onContentPauseRequested.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this.onContentResumeRequested.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,this.onAllAdsCompleted.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.LOADED,this.onAdLoaded.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.STARTED,this.onAdStarted.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.COMPLETE,this.onAdComplete.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.SKIPPED,this.onAdComplete.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.LOG,this.onAdLog.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.PAUSED,this.onAdPaused.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.RESUMED,this.onAdResumed.bind(this)),this.controller.playerWrapper.vjsPlayer.trigger({type:"ads-manager",adsManager:this.adsManager}),this.autoPlayAdBreaks||this.initAdsManager()
t=this.controller.getSettings().preventLateAdStart
t&&this.isAdTimedOut||this.controller.onAdsReady(),this.controller.getSettings().adsManagerLoadedCallback&&this.controller.getSettings().adsManagerLoadedCallback()},r.prototype.onAdsLoaderError=function(t){window.console.warn("AdsLoader error: "+t.getError()),this.controller.onErrorLoadingAds(t),this.adsManager&&this.adsManager.destroy()},r.prototype.initAdsManager=function(){var t,e
try{t=this.controller.getPlayerWidth(),e=this.controller.getPlayerHeight(),this.adsManagerDimensions.width=t,this.adsManagerDimensions.height=e,this.adsManager.init(t,e,google.ima.ViewMode.NORMAL),this.adsManager.setVolume(this.controller.getPlayerVolume()),this.initializeAdDisplayContainer()}catch(t){this.onAdError(t)}},r.prototype.createAdsRenderingSettings=function(){if(this.adsRenderingSettings=new google.ima.AdsRenderingSettings,this.adsRenderingSettings.restoreCustomPlaybackStateOnAdBreakComplete=!0,this.controller.getSettings().adsRenderingSettings)for(var t in this.controller.getSettings().adsRenderingSettings)""!==t&&(this.adsRenderingSettings[t]=this.controller.getSettings().adsRenderingSettings[t])},r.prototype.onAdError=function(t){var e=void 0!==t.getError?t.getError():t.stack
window.console.warn("Ad error: "+e),this.adsManager.destroy(),this.controller.onAdError(t),this.adsActive=!1,this.adPlaying=!1},r.prototype.onAdBreakReady=function(t){this.adBreakReadyListener(t)},r.prototype.onContentPauseRequested=function(t){this.adsActive=!0,this.adPlaying=!0,this.controller.onAdBreakStart(t)},r.prototype.onContentResumeRequested=function(t){this.adsActive=!1,this.adPlaying=!1,this.controller.onAdBreakEnd()},r.prototype.onAllAdsCompleted=function(t){this.allAdsCompleted=!0,this.controller.onAllAdsCompleted()},r.prototype.onAdLoaded=function(t){t.getAd().isLinear()||(this.controller.onNonLinearAdLoad(),this.controller.playContent())},r.prototype.onAdStarted=function(t){this.currentAd=t.getAd(),this.currentAd.isLinear()?(this.adTrackingTimer=setInterval(this.onAdPlayheadTrackerInterval.bind(this),250),this.controller.onLinearAdStart()):this.controller.onNonLinearAdStart()},r.prototype.onAdPaused=function(){this.controller.onAdsPaused()},r.prototype.onAdResumed=function(t){this.controller.onAdsResumed()},r.prototype.onAdComplete=function(){this.currentAd.isLinear()&&clearInterval(this.adTrackingTimer)},r.prototype.onAdLog=function(t){this.controller.onAdLog(t)},r.prototype.onAdPlayheadTrackerInterval=function(){var t,e,n,i,o
null!==this.adsManager&&(t=this.adsManager.getRemainingTime(),n=0<(n=(e=this.currentAd.getDuration())-t)?n:0,o=void(i=0),this.currentAd.getAdPodInfo()&&(o=this.currentAd.getAdPodInfo().getAdPosition(),i=this.currentAd.getAdPodInfo().getTotalAds()),this.controller.onAdPlayheadUpdated(n,t,e,o,i))},r.prototype.onContentComplete=function(){this.adsLoader&&(this.adsLoader.contentComplete(),this.contentCompleteCalled=!0),(this.adsManager&&this.adsManager.getCuePoints()&&!this.adsManager.getCuePoints().includes(-1)||!this.adsManager)&&this.controller.onNoPostroll(),this.allAdsCompleted&&this.controller.onContentAndAdsCompleted()},r.prototype.onPlayerDisposed=function(){this.adTrackingTimer&&clearInterval(this.adTrackingTimer),this.adsManager&&(this.adsManager.destroy(),this.adsManager=null)},r.prototype.onPlayerReadyForPreroll=function(){if(this.autoPlayAdBreaks){this.initAdsManager()
try{this.controller.showAdContainer(),this.adsManager.setVolume(this.controller.getPlayerVolume()),this.adsManager.start()}catch(t){this.onAdError(t)}}},r.prototype.onAdTimeout=function(){this.isAdTimedOut=!0},r.prototype.onPlayerReady=function(){this.initAdObjects(),(this.controller.getSettings().adTagUrl||this.controller.getSettings().adsResponse)&&"onLoad"===this.controller.getSettings().requestMode&&this.requestAds()},r.prototype.onPlayerEnterFullscreen=function(){this.adsManager&&this.adsManager.resize(window.screen.width,window.screen.height,google.ima.ViewMode.FULLSCREEN)},r.prototype.onPlayerExitFullscreen=function(){this.adsManager&&this.adsManager.resize(this.controller.getPlayerWidth(),this.controller.getPlayerHeight(),google.ima.ViewMode.NORMAL)},r.prototype.onPlayerVolumeChanged=function(t){this.adsManager&&this.adsManager.setVolume(t),this.adMuted=0==t},r.prototype.onPlayerResize=function(t,e){this.adsManager&&(this.adsManagerDimensions.width=t,this.adsManagerDimensions.height=e,this.adsManager.resize(t,e,google.ima.ViewMode.NORMAL))},r.prototype.getCurrentAd=function(){return this.currentAd},r.prototype.setAdBreakReadyListener=function(t){this.adBreakReadyListener=t},r.prototype.isAdPlaying=function(){return this.adPlaying},r.prototype.isAdMuted=function(){return this.adMuted},r.prototype.pauseAds=function(){this.adsManager.pause(),this.adPlaying=!1},r.prototype.resumeAds=function(){this.adsManager.resume(),this.adPlaying=!0},r.prototype.unmute=function(){this.adsManager.setVolume(1),this.adMuted=!1},r.prototype.mute=function(){this.adsManager.setVolume(0),this.adMuted=!0},r.prototype.setVolume=function(t){this.adsManager.setVolume(t),this.adMuted=0==t},r.prototype.initializeAdDisplayContainer=function(){!this.adDisplayContainer||this.adDisplayContainerInitialized||(this.adDisplayContainer.initialize(),this.adDisplayContainerInitialized=!0)},r.prototype.playAdBreak=function(){this.autoPlayAdBreaks||(this.controller.showAdContainer(),this.adsManager.setVolume(this.controller.getPlayerVolume()),this.adsManager.start())},r.prototype.addEventListener=function(t,e){this.adsManager&&this.adsManager.addEventListener(t,e)},r.prototype.getAdsManager=function(){return this.adsManager},(a=function(t,e){var n
this.settings={},this.contentAndAdsEndedListeners=[],this.isMobile=navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/Android/i),this.isIos=navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i),this.initWithSettings(e),n={debug:this.settings.debug,timeout:this.settings.timeout,prerollTimeout:this.settings.prerollTimeout},n=Object.assign({},n,e.contribAdsSettings||{}),this.playerWrapper=new i(t,n,this),this.adUi=new o(this),this.sdkImpl=new r(this)}).IMA_DEFAULTS={adLabel:"Advertisement",adLabelNofN:"of",debug:!(r.prototype.reset=function(){this.adsActive=!1,this.adPlaying=!1,this.adTrackingTimer&&clearInterval(this.adTrackingTimer),this.adsManager&&(this.adsManager.destroy(),this.adsManager=null),this.adsLoader&&!this.contentCompleteCalled&&this.adsLoader.contentComplete(),this.contentCompleteCalled=!1,this.allAdsCompleted=!1}),disableAdControls:!1,prerollTimeout:1e3,preventLateAdStart:!1,requestMode:"onLoad",showControlsForJSAds:!0,timeout:5e3},a.prototype.initWithSettings=function(t){this.settings=Object.assign({},a.IMA_DEFAULTS,t||{}),this.warnAboutDeprecatedSettings(),!(this.showCountdown=!0)===this.settings.showCountdown&&(this.showCountdown=!1)},a.prototype.warnAboutDeprecatedSettings=function(){var e=this;["adWillAutoplay","adsWillAutoplay","adWillPlayMuted","adsWillPlayMuted"].forEach(function(t){void 0!==e.settings[t]&&console.warn("WARNING: videojs.ima setting "+t+" is deprecated")})},a.prototype.getSettings=function(){return this.settings},a.prototype.getIsMobile=function(){return this.isMobile},a.prototype.getIsIos=function(){return this.isIos},a.prototype.injectAdContainerDiv=function(t){this.playerWrapper.injectAdContainerDiv(t)},a.prototype.getAdContainerDiv=function(){return this.adUi.getAdContainerDiv()},a.prototype.getContentPlayer=function(){return this.playerWrapper.getContentPlayer()},a.prototype.getContentPlayheadTracker=function(){return this.playerWrapper.getContentPlayheadTracker()},a.prototype.requestAds=function(){this.sdkImpl.requestAds()},a.prototype.setSetting=function(t,e){this.settings[t]=e},a.prototype.onErrorLoadingAds=function(t){this.adUi.onAdError(),this.playerWrapper.onAdError(t)},a.prototype.onAdPlayPauseClick=function(){this.sdkImpl.isAdPlaying()?(this.adUi.onAdsPaused(),this.sdkImpl.pauseAds()):(this.adUi.onAdsPlaying(),this.sdkImpl.resumeAds())},a.prototype.onAdMuteClick=function(){this.sdkImpl.isAdMuted()?(this.playerWrapper.unmute(),this.adUi.unmute(),this.sdkImpl.unmute()):(this.playerWrapper.mute(),this.adUi.mute(),this.sdkImpl.mute())},a.prototype.setVolume=function(t){this.playerWrapper.setVolume(t),this.sdkImpl.setVolume(t)},a.prototype.getPlayerVolume=function(){return this.playerWrapper.getVolume()},a.prototype.toggleFullscreen=function(){this.playerWrapper.toggleFullscreen()},a.prototype.onAdError=function(t){this.adUi.onAdError(),this.playerWrapper.onAdError(t)},a.prototype.onAdBreakStart=function(t){this.playerWrapper.onAdBreakStart(),this.adUi.onAdBreakStart(t)},a.prototype.showAdContainer=function(){this.adUi.showAdContainer()},a.prototype.onAdBreakEnd=function(){this.playerWrapper.onAdBreakEnd(),this.adUi.onAdBreakEnd()},a.prototype.onAllAdsCompleted=function(){this.adUi.onAllAdsCompleted(),this.playerWrapper.onAllAdsCompleted()},a.prototype.onAdsPaused=function(){this.adUi.onAdsPaused()},a.prototype.onAdsResumed=function(){this.adUi.onAdsResumed()},a.prototype.onAdPlayheadUpdated=function(t,e,n,i,o){this.adUi.updateAdUi(t,e,n,i,o)},a.prototype.onAdLog=function(t){this.playerWrapper.onAdLog(t)},a.prototype.getCurrentAd=function(){return this.sdkImpl.getCurrentAd()},a.prototype.playContent=function(){this.playerWrapper.play()},a.prototype.onLinearAdStart=function(){this.adUi.onLinearAdStart(),this.playerWrapper.onAdStart()},a.prototype.onNonLinearAdLoad=function(){this.adUi.onNonLinearAdLoad()},a.prototype.onNonLinearAdStart=function(){this.adUi.onNonLinearAdLoad(),this.playerWrapper.onAdStart()},a.prototype.getPlayerWidth=function(){return this.playerWrapper.getPlayerWidth()},a.prototype.getPlayerHeight=function(){return this.playerWrapper.getPlayerHeight()},a.prototype.onAdsReady=function(){this.playerWrapper.onAdsReady()},a.prototype.onPlayerResize=function(t,e){this.sdkImpl.onPlayerResize(t,e)},a.prototype.onContentComplete=function(){this.sdkImpl.onContentComplete()},a.prototype.onNoPostroll=function(){this.playerWrapper.onNoPostroll()},a.prototype.onContentAndAdsCompleted=function(){for(var t in this.contentAndAdsEndedListeners)"function"==typeof this.contentAndAdsEndedListeners[t]&&this.contentAndAdsEndedListeners[t]()},a.prototype.onPlayerDisposed=function(){this.contentAndAdsEndedListeners=[],this.sdkImpl.onPlayerDisposed()},a.prototype.onPlayerReadyForPreroll=function(){this.sdkImpl.onPlayerReadyForPreroll()},a.prototype.onAdTimeout=function(){this.sdkImpl.onAdTimeout()},a.prototype.onPlayerReady=function(){this.sdkImpl.onPlayerReady()},a.prototype.onPlayerEnterFullscreen=function(){this.adUi.onPlayerEnterFullscreen(),this.sdkImpl.onPlayerEnterFullscreen()},a.prototype.onPlayerExitFullscreen=function(){this.adUi.onPlayerExitFullscreen(),this.sdkImpl.onPlayerExitFullscreen()},a.prototype.onPlayerVolumeChanged=function(t){this.adUi.onPlayerVolumeChanged(t),this.sdkImpl.onPlayerVolumeChanged(t)},a.prototype.setContentWithAdTag=function(t,e){this.reset(),this.settings.adTagUrl=e||this.settings.adTagUrl,this.playerWrapper.changeSource(t)},a.prototype.setContentWithAdsResponse=function(t,e){this.reset(),this.settings.adsResponse=e||this.settings.adsResponse,this.playerWrapper.changeSource(t)},a.prototype.setContentWithAdsRequest=function(t,e){this.reset(),this.settings.adsRequest=e||this.settings.adsRequest,this.playerWrapper.changeSource(t)},a.prototype.reset=function(){this.sdkImpl.reset(),this.playerWrapper.reset(),this.adUi.reset()},a.prototype.addContentEndedListener=function(t){this.playerWrapper.addContentEndedListener(t)},
a.prototype.addContentAndAdsEndedListener=function(t){this.contentAndAdsEndedListeners.push(t)},a.prototype.setAdBreakReadyListener=function(t){this.sdkImpl.setAdBreakReadyListener(t)},a.prototype.setShowCountdown=function(t){this.adUi.setShowCountdown(t),this.showCountdown=t,this.adUi.countdownDiv.style.display=this.showCountdown?"block":"none"},a.prototype.initializeAdDisplayContainer=function(){this.sdkImpl.initializeAdDisplayContainer()},a.prototype.playAdBreak=function(){this.sdkImpl.playAdBreak()},a.prototype.addEventListener=function(t,e){this.sdkImpl.addEventListener(t,e)},a.prototype.getAdsManager=function(){return this.sdkImpl.getAdsManager()},a.prototype.getPlayerId=function(){return this.playerWrapper.getPlayerId()},a.prototype.changeAdTag=function(t){this.reset(),this.settings.adTagUrl=t},a.prototype.pauseAd=function(){this.adUi.onAdsPaused(),this.sdkImpl.pauseAds()},a.prototype.resumeAd=function(){this.adUi.onAdsPlaying(),this.sdkImpl.resumeAds()},a.prototype.togglePlayback=function(){this.playerWrapper.togglePlayback()},a.prototype.adsWillAutoplay=function(){return void 0!==this.settings.adsWillAutoplay?this.settings.adsWillAutoplay:void 0!==this.settings.adWillAutoplay?this.settings.adWillAutoplay:!!this.playerWrapper.getPlayerOptions().autoplay},a.prototype.adsWillPlayMuted=function(){return void 0!==this.settings.adsWillPlayMuted?this.settings.adsWillPlayMuted:void 0!==this.settings.adWillPlayMuted?this.settings.adWillPlayMuted:void 0!==this.playerWrapper.getPlayerOptions().muted?this.playerWrapper.getPlayerOptions().muted:0==this.playerWrapper.getVolume()},a.prototype.triggerPlayerEvent=function(t,e){this.playerWrapper.triggerPlayerEvent(t,e)},(d=function(t,e,n){this.vjsPlayer=t,this.daiController=n,this.vjsControls=this.vjsPlayer.getChild("controlBar"),this.h5Player=null,this.vjsPlayer.on("dispose",this.playerDisposedListener.bind(this)),this.vjsPlayer.on("pause",this.onPause.bind(this)),this.vjsPlayer.on("play",this.onPlay.bind(this)),this.vjsPlayer.on("seeked",this.onSeekEnd.bind(this)),this.vjsPlayer.ready(this.onPlayerReady.bind(this)),this.vjsPlayer.ads(e)}).prototype.playerDisposedListener=function(){this.contentEndedListeners=[],this.daiController.onPlayerDisposed()},d.prototype.onPause=function(){this.daiController.isInAdBreak()&&this.vjsControls.show()},d.prototype.onPlay=function(){this.daiController.isInAdBreak()&&this.vjsControls.hide()},d.prototype.onSeekEnd=function(){this.daiController.onSeekEnd(this.vjsPlayer.currentTime())},d.prototype.onPlayerReady=function(){this.h5Player=document.getElementById(this.getPlayerId()).getElementsByClassName("vjs-tech")[0],this.daiController.onPlayerReady()},d.prototype.getStreamPlayer=function(){return this.h5Player},d.prototype.getVjsPlayer=function(){return this.vjsPlayer},d.prototype.getPlayerOptions=function(){return this.vjsPlayer.options_},d.prototype.getPlayerId=function(){return this.vjsPlayer.id()},d.prototype.onAdError=function(t){this.vjsControls.show()
var e=void 0!==t.getError?t.getError():t.stack
this.vjsPlayer.trigger({type:"adserror",data:{AdError:e,AdErrorEvent:t}})},d.prototype.onAdBreakStart=function(){this.vjsControls.hide()},d.prototype.onAdBreakEnd=function(){this.vjsControls.show()},d.prototype.reset=function(){this.vjsControls.show()},(l=function(t){this.daiController=t,this.streamPlayer=null,this.vjsPlayer=null,this.streamManager=null,this.uiSettings=new google.ima.dai.api.UiSettings,this.isAdBreak=!1,this.isSnapback=!1,this.snapForwardTime=0,this.timedMetadata,this.metadataLoaded={},this.SOURCE_TYPES={hls:"application/x-mpegURL",dash:"application/dash+xml"}}).prototype.initImaDai=function(){this.streamPlayer=this.daiController.getStreamPlayer(),this.vjsPlayer=this.daiController.getVjsPlayer(),this.createAdUiDiv(),this.daiController.getSettings().locale&&this.uiSettings.setLocale(this.daiController.getSettings().locale),this.streamManager=new google.ima.dai.api.StreamManager(this.streamPlayer,this.adUiDiv,this.uiSettings),this.streamPlayer.addEventListener("pause",this.onStreamPause),this.streamPlayer.addEventListener("play",this.onStreamPlay),this.streamManager.addEventListener([google.ima.dai.api.StreamEvent.Type.LOADED,google.ima.dai.api.StreamEvent.Type.ERROR,google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED,google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED],this.onStreamEvent.bind(this),!1),this.vjsPlayer.textTracks().onaddtrack=this.onAddTrack.bind(this),this.vjsPlayer.trigger({type:"stream-manager",StreamManager:this.streamManager}),this.requestStream()},l.prototype.onAddTrack=function(t){var d=this,l=t.track
"metadata"===l.kind&&(l.mode="hidden",l.oncuechange=function(t){var e,n,i,o,s=!0,r=!1,a=void 0
try{for(e=l.activeCues_[Symbol.iterator]();!(s=(n=e.next()).done);s=!0)i=n.value,(o={})[i.value.key]=i.value.data,d.streamManager.onTimedMetadata(o)}catch(t){r=!0,a=t}finally{try{!s&&e.return&&e.return()}finally{if(r)throw a}}})},l.prototype.createAdUiDiv=function(){var t=document.createElement("div")
t.id="ad-ui",t.style.height="calc(100% - 3em)",this.streamPlayer.parentNode.appendChild(t),this.adUiDiv=t},l.prototype.onStreamPause=function(){this.isAdBreak&&(this.adUiDiv.style.display="none")},l.prototype.onStreamPlay=function(){this.isAdBreak&&(this.adUiDiv.style.display="block")},l.prototype.onSeekEnd=function(t){var e
"live"!==this.daiController.getSettings().streamType&&(this.isSnapback?this.isSnapback=!1:(e=this.streamManager.previousCuePointForStreamTime(t))&&!e.played&&(this.isSnapback=!0,this.snapForwardTime=t,this.vjsPlayer.currentTime(e.start)))},l.prototype.onStreamEvent=function(t){switch(t.type){case google.ima.dai.api.StreamEvent.Type.LOADED:this.loadUrl(t.getStreamData().url)
break
case google.ima.dai.api.StreamEvent.Type.ERROR:window.console.warn("Error loading stream, attempting to play backup stream. "+t.getStreamData().errorMessage),this.daiController.onErrorLoadingAds(t),this.daiController.getSettings().fallbackStreamUrl&&this.loadurl(this.daiController.getSettings().fallbackStreamUrl)
break
case google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED:this.isAdBreak=!0,this.adUiDiv.style.display="block",this.daiController.onAdBreakStart()
break
case google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED:this.isAdBreak=!1,this.adUiDiv.style.display="none",this.daiController.onAdBreakEnd(),this.snapForwardTime&&this.snapForwardTime>this.vjsPlayer.currentTime()&&(this.vjsPlayer.currentTime(this.snapForwardTime),this.snapForwardTime=0)}},l.prototype.loadUrl=function(e){this.vjsPlayer.ready(function(){var t=this.daiController.getSettings().streamFormat
this.vjsPlayer.src({src:e,type:this.SOURCE_TYPES[t]}),(t=this.daiController.getSettings().bookmarkTime)&&(t=this.streamManager.streamTimeForContentTime(t),this.isSnapback=!0,this.vjsPlayer.currentTime(t))}.bind(this))},l.prototype.requestStream=function(){var t=void 0,e=this.daiController.getSettings().streamType
"vod"===e?((t=new google.ima.dai.api.VODStreamRequest).contentSourceId=this.daiController.getSettings().cmsId,t.videoId=this.daiController.getSettings().videoId):"live"===e?(t=new google.ima.dai.api.LiveStreamRequest).assetKey=this.daiController.getSettings().assetKey:window.console.warn("No valid stream type selected"),t.format=this.daiController.getSettings().streamFormat,this.daiController.getSettings().apiKey&&(t.apiKey=this.daiController.getSettings().apiKey),this.daiController.getSettings().authToken&&(t.authToken=this.daiController.getSettings().authToken),this.daiController.getSettings().adTagParameters&&(t.adTagParameters=this.daiController.getSettings().adTagParameters),this.daiController.getSettings().streamActivityMonitorId&&(t.streamActivityMonitorId=this.daiController.getSettings().streamActivityMonitorId),this.daiController.getSettings().omidMode&&(t.omidAccessModeRules={},(e=this.daiController.getSettings().omidMode).FULL&&(t.omidAccessModeRules[google.ima.OmidAccessMode.FULL]=e.FULL),e.DOMAIN&&(t.omidAccessModeRules[google.ima.OmidAccessMode.DOMAIN]=e.DOMAIN),e.LIMITED)&&(t.omidAccessModeRules[google.ima.OmidAccessMode.LIMITED]=e.LIMITED),this.streamManager.requestStream(t),this.vjsPlayer.trigger({type:"stream-request",StreamRequest:t})},l.prototype.onPlayerReady=function(){this.initImaDai()},l.prototype.onPlayerDisposed=function(){this.streamManager&&this.streamManager.reset()},l.prototype.getStreamManager=function(){return this.StreamManager},(h=function(t,e){var n
this.inAdBreak=!1,this.settings={},this.isMobile=navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/Android/i),this.isIos=navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i),this.initWithSettings(e),n={debug:this.settings.debug,timeout:this.settings.timeout,prerollTimeout:this.settings.prerollTimeout},n=Object.assign({},n,e.contribAdsSettings||{}),this.playerWrapper=new d(t,n,this),this.sdkImpl=new l(this)}).IMA_DEFAULTS={adLabel:"Advertisement",adLabelNofN:"of",debug:!(l.prototype.reset=function(){this.StreamManager&&this.StreamManager.reset()}),disableAdControls:!1,showControlsForJSAds:!0},h.prototype.initWithSettings=function(t){this.settings=Object.assign({},h.IMA_DEFAULTS,t||{}),this.warnAboutDeprecatedSettings(),!(this.showCountdown=!0)===this.settings.showCountdown&&(this.showCountdown=!1)},h.prototype.warnAboutDeprecatedSettings=function(){var e=this;[].forEach(function(t){void 0!==e.settings[t]&&console.warn("WARNING: videojs.imaDai setting "+t+" is deprecated")})},h.prototype.getSettings=function(){return this.settings},h.prototype.getIsMobile=function(){return this.isMobile},h.prototype.getIsIos=function(){return this.isIos},h.prototype.getStreamPlayer=function(){return this.playerWrapper.getStreamPlayer()},h.prototype.getVjsPlayer=function(){return this.playerWrapper.getVjsPlayer()},h.prototype.requestStream=function(){this.sdkImpl.requestStream()},h.prototype.setSetting=function(t,e){this.settings[t]=e},h.prototype.onErrorLoadingAds=function(t){this.playerWrapper.onAdError(t)},h.prototype.onAdError=function(t){this.playerWrapper.onAdError(t)},h.prototype.onAdBreakStart=function(){this.inAdBreak=!0,this.playerWrapper.onAdBreakStart()},h.prototype.onAdBreakEnd=function(){this.inAdBreak=!1,this.playerWrapper.onAdBreakEnd()},h.prototype.onPlayerDisposed=function(){this.contentAndAdsEndedListeners=[],this.sdkImpl.onPlayerDisposed()},h.prototype.isInAdBreak=function(){return this.inAdBreak},h.prototype.onSeekEnd=function(t){this.sdkImpl.onSeekEnd(t)},h.prototype.onPlayerReady=function(){this.sdkImpl.onPlayerReady()},h.prototype.reset=function(){this.sdkImpl.reset(),this.playerWrapper.reset()},h.prototype.addEventListener=function(t,e){this.sdkImpl.addEventListener(t,e)},h.prototype.getStreamManager=function(){return this.sdkImpl.getStreamManager()},h.prototype.getPlayerId=function(){return this.playerWrapper.getPlayerId()},h.prototype.streamWillAutoplay=function(){return void 0!==this.settings.streamWillAutoplay?this.settings.streamWillAutoplay:!!this.playerWrapper.getPlayerOptions().autoplay},h.prototype.triggerPlayerEvent=function(t,e){this.playerWrapper.triggerPlayerEvent(t,e)},u=function(t,e){this.controller=new a(t,e),this.addContentAndAdsEndedListener=function(t){this.controller.addContentAndAdsEndedListener(t)}.bind(this),this.addContentEndedListener=function(t){this.controller.addContentEndedListener(t)}.bind(this),this.addEventListener=function(t,e){this.controller.addEventListener(t,e)}.bind(this),this.changeAdTag=function(t){this.controller.changeAdTag(t)}.bind(this),this.getAdsManager=function(){return this.controller.getAdsManager()}.bind(this),this.initializeAdDisplayContainer=function(){this.controller.initializeAdDisplayContainer()}.bind(this),this.pauseAd=function(){this.controller.pauseAd()}.bind(this),this.playAdBreak=function(){this.controller.playAdBreak()}.bind(this),this.requestAds=function(){this.controller.requestAds()}.bind(this),this.resumeAd=function(){this.controller.resumeAd()}.bind(this),this.setAdBreakReadyListener=function(t){this.controller.setAdBreakReadyListener(t)}.bind(this),this.setContentWithAdTag=function(t,e){this.controller.setContentWithAdTag(t,e)}.bind(this),this.setContentWithAdsResponse=function(t,e){this.controller.setContentWithAdsResponse(t,e)}.bind(this),this.setContentWithAdsRequest=function(t,e){this.controller.setContentWithAdsRequest(t,e)}.bind(this),this.setShowCountdown=function(t){this.controller.setShowCountdown(t)}.bind(this)},c=function(t,e){this.controller=new h(t,e),this.streamEndedListener=function(t){this.controller.addStreamEndedListener(t)}.bind(this),this.addEventListener=function(t,e){this.controller.addEventListener(t,e)}.bind(this),this.getStreamManager=function(){return this.controller.getStreamManager()}.bind(this)},p=function t(e,n){m(this,t),"hls"!==(e=e.toLowerCase())&&"dash"!==e?window.console.error("VodStream error: incorrect streamFormat."):"dash"===e?window.console.error("streamFormat error: DASH streams are notcurrently supported by this plugin."):"string"!=typeof n?window.console.error("assetKey error: value must be string."):(this.streamFormat=e,this.assetKey=n)},g=function t(e,n,i){m(this,t),"hls"!==(e=e.toLowerCase())&&"dash"!==e?window.console.error("VodStream error: incorrect streamFormat."):"dash"===e?window.console.error("streamFormat error: DASH streams are notcurrently supported by this plugin."):"string"!=typeof n?window.console.error("cmsId error: value must be string."):"string"!=typeof i?window.console.error("videoId error: value must be string."):(this.streamFormat=e,this.cmsId=n,this.videoId=i)},y=function(t,e){if(t instanceof p)e.streamType="live",e.assetKey=t.assetKey
else{if(!(t instanceof g))return void window.console.error("initDai() first parameter must be an instance of LiveStream or VodStream.")
e.streamType="vod",e.cmsId=t.cmsId,e.videoId=t.videoId}e.streamFormat=t.streamFormat,this.imaDai=new c(this,e)},(e=e.registerPlugin||e.plugin)("ima",function(t){this.ima=new u(this,t)}),e("imaDai",y),t.default=u,t.VodStream=g,t.LiveStream=p,Object.defineProperty(t,"__esModule",{value:!0})})
